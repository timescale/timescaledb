-- This file and its contents are licensed under the Timescale License.
-- Please see the included NOTICE for copyright information and
-- LICENSE-TIMESCALE for a copy of the license.
-- Expressions in vectorized aggregation.
\c :TEST_DBNAME :ROLE_SUPERUSER
\pset null $
create function always_null(x int4) returns int4 as $$ select null::int4 $$
language sql strict immutable parallel safe;
create table aggexpr(ts int, i int, x text, b bool, v float4) with (tsdb.hypertable,
    tsdb.compress, tsdb.compress_orderby = 'ts', tsdb.compress_segmentby = 'i, x, b',
    tsdb.partition_column = 'ts', tsdb.chunk_interval = 10);
insert into aggexpr select 1, null, null, null, generate_series(1, 1499);
insert into aggexpr select 2, 2, '2', false, generate_series(1, 1493);
-- Batch divisible by 64 to test proper padding.
insert into aggexpr select 3, case when x % 3 = 1 then 3 else 0 end,
    case when x % 3 = 2 then '3' else '0' end,
    case when x % 3 = 0 then true else false end
from generate_series(1, 960) x;
select count(compress_chunk(x)) from show_chunks('aggexpr') x;
 count 
-------
     1

alter table aggexpr set (tsdb.compress_segmentby = '');
insert into aggexpr select 11, null, null, null, generate_series(1, 1489);
insert into aggexpr select 12, 12, '12', false, generate_series(1, 1487);
insert into aggexpr select 13, case when x % 2 = 0 then 13 else null end,
    case when x % 2 = 1 then '13' else null end, x % 3 = 0, x from generate_series(1, 1483) x;
insert into aggexpr select 14, case when x % 2 = 0 then 14 else null end,
    case when x % 2 = 0 then '14' || x::text else null end, x % 3 = 1, x from generate_series(1, 1481) x;
select count(compress_chunk(x)) from show_chunks('aggexpr') x;
NOTICE:  chunk "_hyper_1_1_chunk" is already converted to columnstore
 count 
-------
     2

vacuum full analyze aggexpr;
-- The batch sorted merge has very close costs for one query, and prevents
-- vectorized aggregation, so we have to get it out of the way.
set timescaledb.enable_decompression_sorted_merge to off;
-- Some functions we are not able to vectorize at the moment.
set timescaledb.debug_require_vector_agg = 'forbid';
-- Volatile expression
select sum((b and random() < 0.0)::int) from aggexpr;
 sum 
-----
   0

-- Non-strict expression
select sum(length(format('%s', x))) from aggexpr;
  sum  
-------
 10799

-- No columnar representation for the expression (numeric)
select sum(factorial(i % 2)) from aggexpr;
 sum  
------
 5421

reset timescaledb.debug_require_vector_agg;
-- Test some functions that are vectorizable.
set timescaledb.debug_require_vector_agg = 'require';
-- /* Uncomment to generate reference. */ set timescaledb.debug_require_vector_agg = 'forbid'; set timescaledb.enable_vectorized_aggregation to off;
select always_null(i) from aggexpr group by 1;
 always_null 
-------------
           $

select
    format('select %s%s from aggexpr%s%s%s;',
            grouping || ', ',
            function,
            ' where ' || condition,
            ' group by ' || grouping,
            format(' order by %s, ', function) || grouping || ' limit 10')
from
    unnest(array[
        'count(*)'
        , 'count(i)'
        , 'count(x)'
        , 'count(b)'
        , 'sum((i = 12)::int)'
        , 'sum(abs(v - 500))'
        ]) with ordinality as function(function, n),
    unnest(array[
        null
        , 'b'
        , 'not b'
        , 'length(x) = 1'
        , 'length(x) < 0'
        , 'i % 2 = 0'
        ]) with ordinality as condition(condition, n),
    unnest(array[
        null
        , 'length(x)'
        , 'lower(x)'
        , 'i % 2'
        , 'ts'
        , 'b'
        , 'v - 501 > 0'
        ]) with ordinality as grouping(grouping, n)
order by grouping.n, condition.n, function.n
\gexec
select count(*) from aggexpr;
 count 
-------
  9892

select count(i) from aggexpr;
 count 
-------
  5421

select count(x) from aggexpr;
 count 
-------
  5422

select count(b) from aggexpr;
 count 
-------
  6904

select sum((i = 12)::int) from aggexpr;
 sum  
------
 1487

select sum(abs(v - 500)) from aggexpr;
   sum   
---------
 3683961

select count(*) from aggexpr where b;
 count 
-------
  1308

select count(i) from aggexpr where b;
 count 
-------
   814

select count(x) from aggexpr where b;
 count 
-------
   814

select count(b) from aggexpr where b;
 count 
-------
  1308

select sum((i = 12)::int) from aggexpr where b;
 sum 
-----
   0

select sum(abs(v - 500)) from aggexpr where b;
  sum   
--------
 404936

select count(*) from aggexpr where not b;
 count 
-------
  5596

select count(i) from aggexpr where not b;
 count 
-------
  4607

select count(x) from aggexpr where not b;
 count 
-------
  4608

select count(b) from aggexpr where not b;
 count 
-------
  5596

select sum((i = 12)::int) from aggexpr where not b;
 sum  
------
 1487

select sum(abs(v - 500)) from aggexpr where not b;
   sum   
---------
 2040470

select count(*) from aggexpr where length(x) = 1;
 count 
-------
  2453

select count(i) from aggexpr where length(x) = 1;
 count 
-------
  2453

select count(x) from aggexpr where length(x) = 1;
 count 
-------
  2453

select count(b) from aggexpr where length(x) = 1;
 count 
-------
  2453

select sum((i = 12)::int) from aggexpr where length(x) = 1;
 sum 
-----
   0

select sum(abs(v - 500)) from aggexpr where length(x) = 1;
  sum   
--------
 618271

select count(*) from aggexpr where length(x) < 0;
 count 
-------
     0

select count(i) from aggexpr where length(x) < 0;
 count 
-------
     0

select count(x) from aggexpr where length(x) < 0;
 count 
-------
     0

select count(b) from aggexpr where length(x) < 0;
 count 
-------
     0

select sum((i = 12)::int) from aggexpr where length(x) < 0;
 sum 
-----
   $

select sum(abs(v - 500)) from aggexpr where length(x) < 0;
 sum 
-----
   $

select count(*) from aggexpr where i % 2 = 0;
 count 
-------
  4360

select count(i) from aggexpr where i % 2 = 0;
 count 
-------
  4360

select count(x) from aggexpr where i % 2 = 0;
 count 
-------
  4360

select count(b) from aggexpr where i % 2 = 0;
 count 
-------
  4360

select sum((i = 12)::int) from aggexpr where i % 2 = 0;
 sum  
------
 1487

select sum(abs(v - 500)) from aggexpr where i % 2 = 0;
   sum   
---------
 1533439

select length(x), count(*) from aggexpr group by length(x) order by count(*), length(x) limit 10;
 length | count 
--------+-------
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      2 |  2229
      1 |  2453
      $ |  4470

select length(x), count(i) from aggexpr group by length(x) order by count(i), length(x) limit 10;
 length | count 
--------+-------
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      $ |   741
      2 |  1487
      1 |  2453

select length(x), count(x) from aggexpr group by length(x) order by count(x), length(x) limit 10;
 length | count 
--------+-------
      $ |     0
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      2 |  2229
      1 |  2453

select length(x), count(b) from aggexpr group by length(x) order by count(b), length(x) limit 10;
 length | count 
--------+-------
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      $ |  1482
      2 |  2229
      1 |  2453

select length(x), sum((i = 12)::int) from aggexpr group by length(x) order by sum((i = 12)::int), length(x) limit 10;
 length | sum  
--------+------
      1 |    0
      3 |    0
      4 |    0
      5 |    0
      6 |    0
      $ |    0
      2 | 1487

select length(x), sum(abs(v - 500)) from aggexpr group by length(x) order by sum(abs(v - 500)), length(x) limit 10;
 length |   sum   
--------+---------
      3 |    1980
      4 |   20070
      5 |  102450
      6 |  178340
      1 |  618271
      2 |  916892
      $ | 1845958

select length(x), count(*) from aggexpr where b group by length(x) order by count(*), length(x) limit 10;
 length | count 
--------+-------
      3 |     1
      4 |    15
      6 |    81
      5 |   150
      2 |   247
      1 |   320
      $ |   494

select length(x), count(i) from aggexpr where b group by length(x) order by count(i), length(x) limit 10;
 length | count 
--------+-------
      2 |     0
      3 |     1
      4 |    15
      6 |    81
      5 |   150
      $ |   247
      1 |   320

select length(x), count(x) from aggexpr where b group by length(x) order by count(x), length(x) limit 10;
 length | count 
--------+-------
      $ |     0
      3 |     1
      4 |    15
      6 |    81
      5 |   150
      2 |   247
      1 |   320

select length(x), count(b) from aggexpr where b group by length(x) order by count(b), length(x) limit 10;
 length | count 
--------+-------
      3 |     1
      4 |    15
      6 |    81
      5 |   150
      2 |   247
      1 |   320
      $ |   494

select length(x), sum((i = 12)::int) from aggexpr where b group by length(x) order by sum((i = 12)::int), length(x) limit 10;
 length | sum 
--------+-----
      1 |   0
      3 |   0
      4 |   0
      5 |   0
      6 |   0
      $ |   0
      2 |   $

select length(x), sum(abs(v - 500)) from aggexpr where b group by length(x) order by sum(abs(v - 500)), length(x) limit 10;
 length |  sum   
--------+--------
      3 |    496
      4 |   6720
      5 |  34118
      6 |  59940
      2 | 101193
      $ | 202469
      1 |      $

select length(x), count(*) from aggexpr where not b group by length(x) order by count(*), length(x) limit 10;
 length | count 
--------+-------
      3 |     3
      4 |    30
      6 |   160
      5 |   300
      $ |   988
      2 |  1982
      1 |  2133

select length(x), count(i) from aggexpr where not b group by length(x) order by count(i), length(x) limit 10;
 length | count 
--------+-------
      3 |     3
      4 |    30
      6 |   160
      5 |   300
      $ |   494
      2 |  1487
      1 |  2133

select length(x), count(x) from aggexpr where not b group by length(x) order by count(x), length(x) limit 10;
 length | count 
--------+-------
      $ |     0
      3 |     3
      4 |    30
      6 |   160
      5 |   300
      2 |  1982
      1 |  2133

select length(x), count(b) from aggexpr where not b group by length(x) order by count(b), length(x) limit 10;
 length | count 
--------+-------
      3 |     3
      4 |    30
      6 |   160
      5 |   300
      $ |   988
      2 |  1982
      1 |  2133

select length(x), sum((i = 12)::int) from aggexpr where not b group by length(x) order by sum((i = 12)::int), length(x) limit 10;
 length | sum  
--------+------
      1 |    0
      3 |    0
      4 |    0
      5 |    0
      6 |    0
      $ |    0
      2 | 1487

select length(x), sum(abs(v - 500)) from aggexpr where not b group by length(x) order by sum(abs(v - 500)), length(x) limit 10;
 length |  sum   
--------+--------
      3 |   1484
      4 |  13350
      5 |  68332
      6 | 118400
      $ | 404934
      1 | 618271
      2 | 815699

select length(x), count(*) from aggexpr where length(x) = 1 group by length(x) order by count(*), length(x) limit 10;
 length | count 
--------+-------
      1 |  2453

select length(x), count(i) from aggexpr where length(x) = 1 group by length(x) order by count(i), length(x) limit 10;
 length | count 
--------+-------
      1 |  2453

select length(x), count(x) from aggexpr where length(x) = 1 group by length(x) order by count(x), length(x) limit 10;
 length | count 
--------+-------
      1 |  2453

select length(x), count(b) from aggexpr where length(x) = 1 group by length(x) order by count(b), length(x) limit 10;
 length | count 
--------+-------
      1 |  2453

select length(x), sum((i = 12)::int) from aggexpr where length(x) = 1 group by length(x) order by sum((i = 12)::int), length(x) limit 10;
 length | sum 
--------+-----
      1 |   0

select length(x), sum(abs(v - 500)) from aggexpr where length(x) = 1 group by length(x) order by sum(abs(v - 500)), length(x) limit 10;
 length |  sum   
--------+--------
      1 | 618271

select length(x), count(*) from aggexpr where length(x) < 0 group by length(x) order by count(*), length(x) limit 10;
 length | count 
--------+-------

select length(x), count(i) from aggexpr where length(x) < 0 group by length(x) order by count(i), length(x) limit 10;
 length | count 
--------+-------

select length(x), count(x) from aggexpr where length(x) < 0 group by length(x) order by count(x), length(x) limit 10;
 length | count 
--------+-------

select length(x), count(b) from aggexpr where length(x) < 0 group by length(x) order by count(b), length(x) limit 10;
 length | count 
--------+-------

select length(x), sum((i = 12)::int) from aggexpr where length(x) < 0 group by length(x) order by sum((i = 12)::int), length(x) limit 10;
 length | sum 
--------+-----

select length(x), sum(abs(v - 500)) from aggexpr where length(x) < 0 group by length(x) order by sum(abs(v - 500)), length(x) limit 10;
 length | sum 
--------+-----

select length(x), count(*) from aggexpr where i % 2 = 0 group by length(x) order by count(*), length(x) limit 10;
 length | count 
--------+-------
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      2 |  1487
      1 |  2133

select length(x), count(i) from aggexpr where i % 2 = 0 group by length(x) order by count(i), length(x) limit 10;
 length | count 
--------+-------
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      2 |  1487
      1 |  2133

select length(x), count(x) from aggexpr where i % 2 = 0 group by length(x) order by count(x), length(x) limit 10;
 length | count 
--------+-------
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      2 |  1487
      1 |  2133

select length(x), count(b) from aggexpr where i % 2 = 0 group by length(x) order by count(b), length(x) limit 10;
 length | count 
--------+-------
      3 |     4
      4 |    45
      6 |   241
      5 |   450
      2 |  1487
      1 |  2133

select length(x), sum((i = 12)::int) from aggexpr where i % 2 = 0 group by length(x) order by sum((i = 12)::int), length(x) limit 10;
 length | sum  
--------+------
      1 |    0
      3 |    0
      4 |    0
      5 |    0
      6 |    0
      2 | 1487

select length(x), sum(abs(v - 500)) from aggexpr where i % 2 = 0 group by length(x) order by sum(abs(v - 500)), length(x) limit 10;
 length |  sum   
--------+--------
      3 |   1980
      4 |  20070
      5 | 102450
      6 | 178340
      2 | 612328
      1 | 618271

select lower(x), count(*) from aggexpr group by lower(x) order by count(*), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1
 141014 |     1

select lower(x), count(i) from aggexpr group by lower(x) order by count(i), lower(x) limit 10;
 lower  | count 
--------+-------
 13     |     0
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1

select lower(x), count(x) from aggexpr group by lower(x) order by count(x), lower(x) limit 10;
 lower  | count 
--------+-------
 $      |     0
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1

select lower(x), count(b) from aggexpr group by lower(x) order by count(b), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1
 141014 |     1

select lower(x), sum((i = 12)::int) from aggexpr group by lower(x) order by sum((i = 12)::int), lower(x) limit 10;
 lower  | sum 
--------+-----
 0      |   0
 1410   |   0
 14100  |   0
 141000 |   0
 141002 |   0
 141004 |   0
 141006 |   0
 141008 |   0
 141010 |   0
 141012 |   0

select lower(x), sum(abs(v - 500)) from aggexpr group by lower(x) order by sum(abs(v - 500)), lower(x) limit 10;
 lower | sum 
-------+-----
 14500 |   0
 14498 |   2
 14502 |   2
 14496 |   4
 14504 |   4
 14494 |   6
 14506 |   6
 14492 |   8
 14508 |   8
 14490 |  10

select lower(x), count(*) from aggexpr where b group by lower(x) order by count(*), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141006 |     1
 141012 |     1
 141018 |     1
 141024 |     1
 141030 |     1
 141036 |     1
 141042 |     1

select lower(x), count(i) from aggexpr where b group by lower(x) order by count(i), lower(x) limit 10;
 lower  | count 
--------+-------
 13     |     0
 1410   |     1
 14100  |     1
 141000 |     1
 141006 |     1
 141012 |     1
 141018 |     1
 141024 |     1
 141030 |     1
 141036 |     1

select lower(x), count(x) from aggexpr where b group by lower(x) order by count(x), lower(x) limit 10;
 lower  | count 
--------+-------
 $      |     0
 1410   |     1
 14100  |     1
 141000 |     1
 141006 |     1
 141012 |     1
 141018 |     1
 141024 |     1
 141030 |     1
 141036 |     1

select lower(x), count(b) from aggexpr where b group by lower(x) order by count(b), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141006 |     1
 141012 |     1
 141018 |     1
 141024 |     1
 141030 |     1
 141036 |     1
 141042 |     1

select lower(x), sum((i = 12)::int) from aggexpr where b group by lower(x) order by sum((i = 12)::int), lower(x) limit 10;
 lower  | sum 
--------+-----
 0      |   0
 1410   |   0
 14100  |   0
 141000 |   0
 141006 |   0
 141012 |   0
 141018 |   0
 141024 |   0
 141030 |   0
 141036 |   0

select lower(x), sum(abs(v - 500)) from aggexpr where b group by lower(x) order by sum(abs(v - 500)), lower(x) limit 10;
 lower | sum 
-------+-----
 14502 |   2
 14496 |   4
 14508 |   8
 14490 |  10
 14514 |  14
 14484 |  16
 14520 |  20
 14478 |  22
 14526 |  26
 14472 |  28

select lower(x), count(*) from aggexpr where not b group by lower(x) order by count(*), lower(x) limit 10;
 lower  | count 
--------+-------
 141002 |     1
 141004 |     1
 141008 |     1
 141010 |     1
 141014 |     1
 141016 |     1
 14102  |     1
 141020 |     1
 141022 |     1
 141026 |     1

select lower(x), count(i) from aggexpr where not b group by lower(x) order by count(i), lower(x) limit 10;
 lower  | count 
--------+-------
 13     |     0
 141002 |     1
 141004 |     1
 141008 |     1
 141010 |     1
 141014 |     1
 141016 |     1
 14102  |     1
 141020 |     1
 141022 |     1

select lower(x), count(x) from aggexpr where not b group by lower(x) order by count(x), lower(x) limit 10;
 lower  | count 
--------+-------
 $      |     0
 141002 |     1
 141004 |     1
 141008 |     1
 141010 |     1
 141014 |     1
 141016 |     1
 14102  |     1
 141020 |     1
 141022 |     1

select lower(x), count(b) from aggexpr where not b group by lower(x) order by count(b), lower(x) limit 10;
 lower  | count 
--------+-------
 141002 |     1
 141004 |     1
 141008 |     1
 141010 |     1
 141014 |     1
 141016 |     1
 14102  |     1
 141020 |     1
 141022 |     1
 141026 |     1

select lower(x), sum((i = 12)::int) from aggexpr where not b group by lower(x) order by sum((i = 12)::int), lower(x) limit 10;
 lower  | sum 
--------+-----
 0      |   0
 141002 |   0
 141004 |   0
 141008 |   0
 141010 |   0
 141014 |   0
 141016 |   0
 14102  |   0
 141020 |   0
 141022 |   0

select lower(x), sum(abs(v - 500)) from aggexpr where not b group by lower(x) order by sum(abs(v - 500)), lower(x) limit 10;
 lower | sum 
-------+-----
 14500 |   0
 14498 |   2
 14504 |   4
 14494 |   6
 14506 |   6
 14492 |   8
 14510 |  10
 14488 |  12
 14512 |  12
 14486 |  14

select lower(x), count(*) from aggexpr where length(x) = 1 group by lower(x) order by count(*), lower(x) limit 10;
 lower | count 
-------+-------
 3     |   320
 0     |   640
 2     |  1493

select lower(x), count(i) from aggexpr where length(x) = 1 group by lower(x) order by count(i), lower(x) limit 10;
 lower | count 
-------+-------
 3     |   320
 0     |   640
 2     |  1493

select lower(x), count(x) from aggexpr where length(x) = 1 group by lower(x) order by count(x), lower(x) limit 10;
 lower | count 
-------+-------
 3     |   320
 0     |   640
 2     |  1493

select lower(x), count(b) from aggexpr where length(x) = 1 group by lower(x) order by count(b), lower(x) limit 10;
 lower | count 
-------+-------
 3     |   320
 0     |   640
 2     |  1493

select lower(x), sum((i = 12)::int) from aggexpr where length(x) = 1 group by lower(x) order by sum((i = 12)::int), lower(x) limit 10;
 lower | sum 
-------+-----
 0     |   0
 2     |   0
 3     |   0

select lower(x), sum(abs(v - 500)) from aggexpr where length(x) = 1 group by lower(x) order by sum(abs(v - 500)), lower(x) limit 10;
 lower |  sum   
-------+--------
 2     | 618271
 0     |      $
 3     |      $

select lower(x), count(*) from aggexpr where length(x) < 0 group by lower(x) order by count(*), lower(x) limit 10;
 lower | count 
-------+-------

select lower(x), count(i) from aggexpr where length(x) < 0 group by lower(x) order by count(i), lower(x) limit 10;
 lower | count 
-------+-------

select lower(x), count(x) from aggexpr where length(x) < 0 group by lower(x) order by count(x), lower(x) limit 10;
 lower | count 
-------+-------

select lower(x), count(b) from aggexpr where length(x) < 0 group by lower(x) order by count(b), lower(x) limit 10;
 lower | count 
-------+-------

select lower(x), sum((i = 12)::int) from aggexpr where length(x) < 0 group by lower(x) order by sum((i = 12)::int), lower(x) limit 10;
 lower | sum 
-------+-----

select lower(x), sum(abs(v - 500)) from aggexpr where length(x) < 0 group by lower(x) order by sum(abs(v - 500)), lower(x) limit 10;
 lower | sum 
-------+-----

select lower(x), count(*) from aggexpr where i % 2 = 0 group by lower(x) order by count(*), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1
 141014 |     1

select lower(x), count(i) from aggexpr where i % 2 = 0 group by lower(x) order by count(i), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1
 141014 |     1

select lower(x), count(x) from aggexpr where i % 2 = 0 group by lower(x) order by count(x), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1
 141014 |     1

select lower(x), count(b) from aggexpr where i % 2 = 0 group by lower(x) order by count(b), lower(x) limit 10;
 lower  | count 
--------+-------
 1410   |     1
 14100  |     1
 141000 |     1
 141002 |     1
 141004 |     1
 141006 |     1
 141008 |     1
 141010 |     1
 141012 |     1
 141014 |     1

select lower(x), sum((i = 12)::int) from aggexpr where i % 2 = 0 group by lower(x) order by sum((i = 12)::int), lower(x) limit 10;
 lower  | sum 
--------+-----
 0      |   0
 1410   |   0
 14100  |   0
 141000 |   0
 141002 |   0
 141004 |   0
 141006 |   0
 141008 |   0
 141010 |   0
 141012 |   0

select lower(x), sum(abs(v - 500)) from aggexpr where i % 2 = 0 group by lower(x) order by sum(abs(v - 500)), lower(x) limit 10;
 lower | sum 
-------+-----
 14500 |   0
 14498 |   2
 14502 |   2
 14496 |   4
 14504 |   4
 14494 |   6
 14506 |   6
 14492 |   8
 14508 |   8
 14490 |  10

select i % 2, count(*) from aggexpr group by i % 2 order by count(*), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |  1061
        0 |  4360
        $ |  4471

select i % 2, count(i) from aggexpr group by i % 2 order by count(i), i % 2 limit 10;
 ?column? | count 
----------+-------
        $ |     0
        1 |  1061
        0 |  4360

select i % 2, count(x) from aggexpr group by i % 2 order by count(x), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   320
        $ |   742
        0 |  4360

select i % 2, count(b) from aggexpr group by i % 2 order by count(b), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |  1061
        $ |  1483
        0 |  4360

select i % 2, sum((i = 12)::int) from aggexpr group by i % 2 order by sum((i = 12)::int), i % 2 limit 10;
 ?column? | sum  
----------+------
        1 |    0
        0 | 1487
        $ |    $

select i % 2, sum(abs(v - 500)) from aggexpr group by i % 2 order by sum(abs(v - 500)), i % 2 limit 10;
 ?column? |   sum   
----------+---------
        1 |  303822
        0 | 1533439
        $ | 1846700

select i % 2, count(*) from aggexpr where b group by i % 2 order by count(*), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   247
        $ |   494
        0 |   567

select i % 2, count(i) from aggexpr where b group by i % 2 order by count(i), i % 2 limit 10;
 ?column? | count 
----------+-------
        $ |     0
        1 |   247
        0 |   567

select i % 2, count(x) from aggexpr where b group by i % 2 order by count(x), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |     0
        $ |   247
        0 |   567

select i % 2, count(b) from aggexpr where b group by i % 2 order by count(b), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   247
        $ |   494
        0 |   567

select i % 2, sum((i = 12)::int) from aggexpr where b group by i % 2 order by sum((i = 12)::int), i % 2 limit 10;
 ?column? | sum 
----------+-----
        0 |   0
        1 |   0
        $ |   $

select i % 2, sum(abs(v - 500)) from aggexpr where b group by i % 2 order by sum(abs(v - 500)), i % 2 limit 10;
 ?column? |  sum   
----------+--------
        0 | 101274
        1 | 101436
        $ | 202226

select i % 2, count(*) from aggexpr where not b group by i % 2 order by count(*), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   814
        $ |   989
        0 |  3793

select i % 2, count(i) from aggexpr where not b group by i % 2 order by count(i), i % 2 limit 10;
 ?column? | count 
----------+-------
        $ |     0
        1 |   814
        0 |  3793

select i % 2, count(x) from aggexpr where not b group by i % 2 order by count(x), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   320
        $ |   495
        0 |  3793

select i % 2, count(b) from aggexpr where not b group by i % 2 order by count(b), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   814
        $ |   989
        0 |  3793

select i % 2, sum((i = 12)::int) from aggexpr where not b group by i % 2 order by sum((i = 12)::int), i % 2 limit 10;
 ?column? | sum  
----------+------
        1 |    0
        0 | 1487
        $ |    $

select i % 2, sum(abs(v - 500)) from aggexpr where not b group by i % 2 order by sum(abs(v - 500)), i % 2 limit 10;
 ?column? |   sum   
----------+---------
        1 |  202386
        $ |  405919
        0 | 1432165

select i % 2, count(*) from aggexpr where length(x) = 1 group by i % 2 order by count(*), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   320
        0 |  2133

select i % 2, count(i) from aggexpr where length(x) = 1 group by i % 2 order by count(i), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   320
        0 |  2133

select i % 2, count(x) from aggexpr where length(x) = 1 group by i % 2 order by count(x), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   320
        0 |  2133

select i % 2, count(b) from aggexpr where length(x) = 1 group by i % 2 order by count(b), i % 2 limit 10;
 ?column? | count 
----------+-------
        1 |   320
        0 |  2133

select i % 2, sum((i = 12)::int) from aggexpr where length(x) = 1 group by i % 2 order by sum((i = 12)::int), i % 2 limit 10;
 ?column? | sum 
----------+-----
        0 |   0
        1 |   0

select i % 2, sum(abs(v - 500)) from aggexpr where length(x) = 1 group by i % 2 order by sum(abs(v - 500)), i % 2 limit 10;
 ?column? |  sum   
----------+--------
        0 | 618271
        1 |      $

select i % 2, count(*) from aggexpr where length(x) < 0 group by i % 2 order by count(*), i % 2 limit 10;
 ?column? | count 
----------+-------

select i % 2, count(i) from aggexpr where length(x) < 0 group by i % 2 order by count(i), i % 2 limit 10;
 ?column? | count 
----------+-------

select i % 2, count(x) from aggexpr where length(x) < 0 group by i % 2 order by count(x), i % 2 limit 10;
 ?column? | count 
----------+-------

select i % 2, count(b) from aggexpr where length(x) < 0 group by i % 2 order by count(b), i % 2 limit 10;
 ?column? | count 
----------+-------

select i % 2, sum((i = 12)::int) from aggexpr where length(x) < 0 group by i % 2 order by sum((i = 12)::int), i % 2 limit 10;
 ?column? | sum 
----------+-----

select i % 2, sum(abs(v - 500)) from aggexpr where length(x) < 0 group by i % 2 order by sum(abs(v - 500)), i % 2 limit 10;
 ?column? | sum 
----------+-----

select i % 2, count(*) from aggexpr where i % 2 = 0 group by i % 2 order by count(*), i % 2 limit 10;
 ?column? | count 
----------+-------
        0 |  4360

select i % 2, count(i) from aggexpr where i % 2 = 0 group by i % 2 order by count(i), i % 2 limit 10;
 ?column? | count 
----------+-------
        0 |  4360

select i % 2, count(x) from aggexpr where i % 2 = 0 group by i % 2 order by count(x), i % 2 limit 10;
 ?column? | count 
----------+-------
        0 |  4360

select i % 2, count(b) from aggexpr where i % 2 = 0 group by i % 2 order by count(b), i % 2 limit 10;
 ?column? | count 
----------+-------
        0 |  4360

select i % 2, sum((i = 12)::int) from aggexpr where i % 2 = 0 group by i % 2 order by sum((i = 12)::int), i % 2 limit 10;
 ?column? | sum  
----------+------
        0 | 1487

select i % 2, sum(abs(v - 500)) from aggexpr where i % 2 = 0 group by i % 2 order by sum(abs(v - 500)), i % 2 limit 10;
 ?column? |   sum   
----------+---------
        0 | 1533439

select ts, count(*) from aggexpr group by ts order by count(*), ts limit 10;
 ts | count 
----+-------
  3 |   960
 14 |  1481
 13 |  1483
 12 |  1487
 11 |  1489
  2 |  1493
  1 |  1499

select ts, count(i) from aggexpr group by ts order by count(i), ts limit 10;
 ts | count 
----+-------
  1 |     0
 11 |     0
 14 |   740
 13 |   741
  3 |   960
 12 |  1487
  2 |  1493

select ts, count(x) from aggexpr group by ts order by count(x), ts limit 10;
 ts | count 
----+-------
  1 |     0
 11 |     0
 14 |   740
 13 |   742
  3 |   960
 12 |  1487
  2 |  1493

select ts, count(b) from aggexpr group by ts order by count(b), ts limit 10;
 ts | count 
----+-------
  1 |     0
 11 |     0
  3 |   960
 14 |  1481
 13 |  1483
 12 |  1487
  2 |  1493

select ts, sum((i = 12)::int) from aggexpr group by ts order by sum((i = 12)::int), ts limit 10;
 ts | sum  
----+------
  2 |    0
  3 |    0
 13 |    0
 14 |    0
 12 | 1487
  1 |    $
 11 |    $

select ts, sum(abs(v - 500)) from aggexpr group by ts order by sum(abs(v - 500)), ts limit 10;
 ts |  sum   
----+--------
 14 | 606421
 13 | 608386
 12 | 612328
 11 | 614305
  2 | 618271
  1 | 624250
  3 |      $

select ts, count(*) from aggexpr where b group by ts order by count(*), ts limit 10;
 ts | count 
----+-------
  3 |   320
 13 |   494
 14 |   494

select ts, count(i) from aggexpr where b group by ts order by count(i), ts limit 10;
 ts | count 
----+-------
 13 |   247
 14 |   247
  3 |   320

select ts, count(x) from aggexpr where b group by ts order by count(x), ts limit 10;
 ts | count 
----+-------
 13 |   247
 14 |   247
  3 |   320

select ts, count(b) from aggexpr where b group by ts order by count(b), ts limit 10;
 ts | count 
----+-------
  3 |   320
 13 |   494
 14 |   494

select ts, sum((i = 12)::int) from aggexpr where b group by ts order by sum((i = 12)::int), ts limit 10;
 ts | sum 
----+-----
  3 |   0
 13 |   0
 14 |   0

select ts, sum(abs(v - 500)) from aggexpr where b group by ts order by sum(abs(v - 500)), ts limit 10;
 ts |  sum   
----+--------
 14 | 202307
 13 | 202629
  3 |      $

select ts, count(*) from aggexpr where not b group by ts order by count(*), ts limit 10;
 ts | count 
----+-------
  3 |   640
 14 |   987
 13 |   989
 12 |  1487
  2 |  1493

select ts, count(i) from aggexpr where not b group by ts order by count(i), ts limit 10;
 ts | count 
----+-------
 14 |   493
 13 |   494
  3 |   640
 12 |  1487
  2 |  1493

select ts, count(x) from aggexpr where not b group by ts order by count(x), ts limit 10;
 ts | count 
----+-------
 14 |   493
 13 |   495
  3 |   640
 12 |  1487
  2 |  1493

select ts, count(b) from aggexpr where not b group by ts order by count(b), ts limit 10;
 ts | count 
----+-------
  3 |   640
 14 |   987
 13 |   989
 12 |  1487
  2 |  1493

select ts, sum((i = 12)::int) from aggexpr where not b group by ts order by sum((i = 12)::int), ts limit 10;
 ts | sum  
----+------
  2 |    0
  3 |    0
 13 |    0
 14 |    0
 12 | 1487

select ts, sum(abs(v - 500)) from aggexpr where not b group by ts order by sum(abs(v - 500)), ts limit 10;
 ts |  sum   
----+--------
 14 | 404114
 13 | 405757
 12 | 612328
  2 | 618271
  3 |      $

select ts, count(*) from aggexpr where length(x) = 1 group by ts order by count(*), ts limit 10;
 ts | count 
----+-------
  3 |   960
  2 |  1493

select ts, count(i) from aggexpr where length(x) = 1 group by ts order by count(i), ts limit 10;
 ts | count 
----+-------
  3 |   960
  2 |  1493

select ts, count(x) from aggexpr where length(x) = 1 group by ts order by count(x), ts limit 10;
 ts | count 
----+-------
  3 |   960
  2 |  1493

select ts, count(b) from aggexpr where length(x) = 1 group by ts order by count(b), ts limit 10;
 ts | count 
----+-------
  3 |   960
  2 |  1493

select ts, sum((i = 12)::int) from aggexpr where length(x) = 1 group by ts order by sum((i = 12)::int), ts limit 10;
 ts | sum 
----+-----
  2 |   0
  3 |   0

select ts, sum(abs(v - 500)) from aggexpr where length(x) = 1 group by ts order by sum(abs(v - 500)), ts limit 10;
 ts |  sum   
----+--------
  2 | 618271
  3 |      $

select ts, count(*) from aggexpr where length(x) < 0 group by ts order by count(*), ts limit 10;
 ts | count 
----+-------

select ts, count(i) from aggexpr where length(x) < 0 group by ts order by count(i), ts limit 10;
 ts | count 
----+-------

select ts, count(x) from aggexpr where length(x) < 0 group by ts order by count(x), ts limit 10;
 ts | count 
----+-------

select ts, count(b) from aggexpr where length(x) < 0 group by ts order by count(b), ts limit 10;
 ts | count 
----+-------

select ts, sum((i = 12)::int) from aggexpr where length(x) < 0 group by ts order by sum((i = 12)::int), ts limit 10;
 ts | sum 
----+-----

select ts, sum(abs(v - 500)) from aggexpr where length(x) < 0 group by ts order by sum(abs(v - 500)), ts limit 10;
 ts | sum 
----+-----

select ts, count(*) from aggexpr where i % 2 = 0 group by ts order by count(*), ts limit 10;
 ts | count 
----+-------
  3 |   640
 14 |   740
 12 |  1487
  2 |  1493

select ts, count(i) from aggexpr where i % 2 = 0 group by ts order by count(i), ts limit 10;
 ts | count 
----+-------
  3 |   640
 14 |   740
 12 |  1487
  2 |  1493

select ts, count(x) from aggexpr where i % 2 = 0 group by ts order by count(x), ts limit 10;
 ts | count 
----+-------
  3 |   640
 14 |   740
 12 |  1487
  2 |  1493

select ts, count(b) from aggexpr where i % 2 = 0 group by ts order by count(b), ts limit 10;
 ts | count 
----+-------
  3 |   640
 14 |   740
 12 |  1487
  2 |  1493

select ts, sum((i = 12)::int) from aggexpr where i % 2 = 0 group by ts order by sum((i = 12)::int), ts limit 10;
 ts | sum  
----+------
  2 |    0
  3 |    0
 14 |    0
 12 | 1487

select ts, sum(abs(v - 500)) from aggexpr where i % 2 = 0 group by ts order by sum(abs(v - 500)), ts limit 10;
 ts |  sum   
----+--------
 14 | 302840
 12 | 612328
  2 | 618271
  3 |      $

select b, count(*) from aggexpr group by b order by count(*), b limit 10;
 b | count 
---+-------
 t |  1308
 $ |  2988
 f |  5596

select b, count(i) from aggexpr group by b order by count(i), b limit 10;
 b | count 
---+-------
 $ |     0
 t |   814
 f |  4607

select b, count(x) from aggexpr group by b order by count(x), b limit 10;
 b | count 
---+-------
 $ |     0
 t |   814
 f |  4608

select b, count(b) from aggexpr group by b order by count(b), b limit 10;
 b | count 
---+-------
 $ |     0
 t |  1308
 f |  5596

select b, sum((i = 12)::int) from aggexpr group by b order by sum((i = 12)::int), b limit 10;
 b | sum  
---+------
 t |    0
 f | 1487
 $ |    $

select b, sum(abs(v - 500)) from aggexpr group by b order by sum(abs(v - 500)), b limit 10;
 b |   sum   
---+---------
 t |  404936
 $ | 1238555
 f | 2040470

select b, count(*) from aggexpr where b group by b order by count(*), b limit 10;
 b | count 
---+-------
 t |  1308

select b, count(i) from aggexpr where b group by b order by count(i), b limit 10;
 b | count 
---+-------
 t |   814

select b, count(x) from aggexpr where b group by b order by count(x), b limit 10;
 b | count 
---+-------
 t |   814

select b, count(b) from aggexpr where b group by b order by count(b), b limit 10;
 b | count 
---+-------
 t |  1308

select b, sum((i = 12)::int) from aggexpr where b group by b order by sum((i = 12)::int), b limit 10;
 b | sum 
---+-----
 t |   0

select b, sum(abs(v - 500)) from aggexpr where b group by b order by sum(abs(v - 500)), b limit 10;
 b |  sum   
---+--------
 t | 404936

select b, count(*) from aggexpr where not b group by b order by count(*), b limit 10;
 b | count 
---+-------
 f |  5596

select b, count(i) from aggexpr where not b group by b order by count(i), b limit 10;
 b | count 
---+-------
 f |  4607

select b, count(x) from aggexpr where not b group by b order by count(x), b limit 10;
 b | count 
---+-------
 f |  4608

select b, count(b) from aggexpr where not b group by b order by count(b), b limit 10;
 b | count 
---+-------
 f |  5596

select b, sum((i = 12)::int) from aggexpr where not b group by b order by sum((i = 12)::int), b limit 10;
 b | sum  
---+------
 f | 1487

select b, sum(abs(v - 500)) from aggexpr where not b group by b order by sum(abs(v - 500)), b limit 10;
 b |   sum   
---+---------
 f | 2040470

select b, count(*) from aggexpr where length(x) = 1 group by b order by count(*), b limit 10;
 b | count 
---+-------
 t |   320
 f |  2133

select b, count(i) from aggexpr where length(x) = 1 group by b order by count(i), b limit 10;
 b | count 
---+-------
 t |   320
 f |  2133

select b, count(x) from aggexpr where length(x) = 1 group by b order by count(x), b limit 10;
 b | count 
---+-------
 t |   320
 f |  2133

select b, count(b) from aggexpr where length(x) = 1 group by b order by count(b), b limit 10;
 b | count 
---+-------
 t |   320
 f |  2133

select b, sum((i = 12)::int) from aggexpr where length(x) = 1 group by b order by sum((i = 12)::int), b limit 10;
 b | sum 
---+-----
 f |   0
 t |   0

select b, sum(abs(v - 500)) from aggexpr where length(x) = 1 group by b order by sum(abs(v - 500)), b limit 10;
 b |  sum   
---+--------
 f | 618271
 t |      $

select b, count(*) from aggexpr where length(x) < 0 group by b order by count(*), b limit 10;
 b | count 
---+-------

select b, count(i) from aggexpr where length(x) < 0 group by b order by count(i), b limit 10;
 b | count 
---+-------

select b, count(x) from aggexpr where length(x) < 0 group by b order by count(x), b limit 10;
 b | count 
---+-------

select b, count(b) from aggexpr where length(x) < 0 group by b order by count(b), b limit 10;
 b | count 
---+-------

select b, sum((i = 12)::int) from aggexpr where length(x) < 0 group by b order by sum((i = 12)::int), b limit 10;
 b | sum 
---+-----

select b, sum(abs(v - 500)) from aggexpr where length(x) < 0 group by b order by sum(abs(v - 500)), b limit 10;
 b | sum 
---+-----

select b, count(*) from aggexpr where i % 2 = 0 group by b order by count(*), b limit 10;
 b | count 
---+-------
 t |   567
 f |  3793

select b, count(i) from aggexpr where i % 2 = 0 group by b order by count(i), b limit 10;
 b | count 
---+-------
 t |   567
 f |  3793

select b, count(x) from aggexpr where i % 2 = 0 group by b order by count(x), b limit 10;
 b | count 
---+-------
 t |   567
 f |  3793

select b, count(b) from aggexpr where i % 2 = 0 group by b order by count(b), b limit 10;
 b | count 
---+-------
 t |   567
 f |  3793

select b, sum((i = 12)::int) from aggexpr where i % 2 = 0 group by b order by sum((i = 12)::int), b limit 10;
 b | sum  
---+------
 t |    0
 f | 1487

select b, sum(abs(v - 500)) from aggexpr where i % 2 = 0 group by b order by sum(abs(v - 500)), b limit 10;
 b |   sum   
---+---------
 t |  101274
 f | 1432165

select v - 501 > 0, count(*) from aggexpr group by v - 501 > 0 order by count(*), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   960
 f        |  3006
 t        |  5926

select v - 501 > 0, count(i) from aggexpr group by v - 501 > 0 order by count(i), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   960
 f        |  1502
 t        |  2959

select v - 501 > 0, count(x) from aggexpr group by v - 501 > 0 order by count(x), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   960
 f        |  1503
 t        |  2959

select v - 501 > 0, count(b) from aggexpr group by v - 501 > 0 order by count(b), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   960
 f        |  2004
 t        |  3940

select v - 501 > 0, sum((i = 12)::int) from aggexpr group by v - 501 > 0 order by sum((i = 12)::int), v - 501 > 0 limit 10;
 ?column? | sum 
----------+-----
 $        |   0
 f        | 501
 t        | 986

select v - 501 > 0, sum(abs(v - 500)) from aggexpr group by v - 501 > 0 order by sum(abs(v - 500)), v - 501 > 0 limit 10;
 ?column? |   sum   
----------+---------
 f        |  748506
 t        | 2935455
 $        |       $

select v - 501 > 0, count(*) from aggexpr where b group by v - 501 > 0 order by count(*), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   320
 f        |   334
 t        |   654

select v - 501 > 0, count(i) from aggexpr where b group by v - 501 > 0 order by count(i), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 f        |   166
 $        |   320
 t        |   328

select v - 501 > 0, count(x) from aggexpr where b group by v - 501 > 0 order by count(x), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 f        |   167
 $        |   320
 t        |   327

select v - 501 > 0, count(b) from aggexpr where b group by v - 501 > 0 order by count(b), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   320
 f        |   334
 t        |   654

select v - 501 > 0, sum((i = 12)::int) from aggexpr where b group by v - 501 > 0 order by sum((i = 12)::int), v - 501 > 0 limit 10;
 ?column? | sum 
----------+-----
 f        |   0
 t        |   0
 $        |   0

select v - 501 > 0, sum(abs(v - 500)) from aggexpr where b group by v - 501 > 0 order by sum(abs(v - 500)), v - 501 > 0 limit 10;
 ?column? |  sum   
----------+--------
 f        |  83168
 t        | 321768
 $        |      $

select v - 501 > 0, count(*) from aggexpr where not b group by v - 501 > 0 order by count(*), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1670
 t        |  3286

select v - 501 > 0, count(i) from aggexpr where not b group by v - 501 > 0 order by count(i), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1336
 t        |  2631

select v - 501 > 0, count(x) from aggexpr where not b group by v - 501 > 0 order by count(x), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1336
 t        |  2632

select v - 501 > 0, count(b) from aggexpr where not b group by v - 501 > 0 order by count(b), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1670
 t        |  3286

select v - 501 > 0, sum((i = 12)::int) from aggexpr where not b group by v - 501 > 0 order by sum((i = 12)::int), v - 501 > 0 limit 10;
 ?column? | sum 
----------+-----
 $        |   0
 f        | 501
 t        | 986

select v - 501 > 0, sum(abs(v - 500)) from aggexpr where not b group by v - 501 > 0 order by sum(abs(v - 500)), v - 501 > 0 limit 10;
 ?column? |   sum   
----------+---------
 f        |  415836
 t        | 1624634
 $        |       $

select v - 501 > 0, count(*) from aggexpr where length(x) = 1 group by v - 501 > 0 order by count(*), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 f        |   501
 $        |   960
 t        |   992

select v - 501 > 0, count(i) from aggexpr where length(x) = 1 group by v - 501 > 0 order by count(i), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 f        |   501
 $        |   960
 t        |   992

select v - 501 > 0, count(x) from aggexpr where length(x) = 1 group by v - 501 > 0 order by count(x), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 f        |   501
 $        |   960
 t        |   992

select v - 501 > 0, count(b) from aggexpr where length(x) = 1 group by v - 501 > 0 order by count(b), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 f        |   501
 $        |   960
 t        |   992

select v - 501 > 0, sum((i = 12)::int) from aggexpr where length(x) = 1 group by v - 501 > 0 order by sum((i = 12)::int), v - 501 > 0 limit 10;
 ?column? | sum 
----------+-----
 f        |   0
 t        |   0
 $        |   0

select v - 501 > 0, sum(abs(v - 500)) from aggexpr where length(x) = 1 group by v - 501 > 0 order by sum(abs(v - 500)), v - 501 > 0 limit 10;
 ?column? |  sum   
----------+--------
 f        | 124751
 t        | 493520
 $        |      $

select v - 501 > 0, count(*) from aggexpr where length(x) < 0 group by v - 501 > 0 order by count(*), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------

select v - 501 > 0, count(i) from aggexpr where length(x) < 0 group by v - 501 > 0 order by count(i), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------

select v - 501 > 0, count(x) from aggexpr where length(x) < 0 group by v - 501 > 0 order by count(x), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------

select v - 501 > 0, count(b) from aggexpr where length(x) < 0 group by v - 501 > 0 order by count(b), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------

select v - 501 > 0, sum((i = 12)::int) from aggexpr where length(x) < 0 group by v - 501 > 0 order by sum((i = 12)::int), v - 501 > 0 limit 10;
 ?column? | sum 
----------+-----

select v - 501 > 0, sum(abs(v - 500)) from aggexpr where length(x) < 0 group by v - 501 > 0 order by sum(abs(v - 500)), v - 501 > 0 limit 10;
 ?column? | sum 
----------+-----

select v - 501 > 0, count(*) from aggexpr where i % 2 = 0 group by v - 501 > 0 order by count(*), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1252
 t        |  2468

select v - 501 > 0, count(i) from aggexpr where i % 2 = 0 group by v - 501 > 0 order by count(i), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1252
 t        |  2468

select v - 501 > 0, count(x) from aggexpr where i % 2 = 0 group by v - 501 > 0 order by count(x), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1252
 t        |  2468

select v - 501 > 0, count(b) from aggexpr where i % 2 = 0 group by v - 501 > 0 order by count(b), v - 501 > 0 limit 10;
 ?column? | count 
----------+-------
 $        |   640
 f        |  1252
 t        |  2468

select v - 501 > 0, sum((i = 12)::int) from aggexpr where i % 2 = 0 group by v - 501 > 0 order by sum((i = 12)::int), v - 501 > 0 limit 10;
 ?column? | sum 
----------+-----
 $        |   0
 f        | 501
 t        | 986

select v - 501 > 0, sum(abs(v - 500)) from aggexpr where i % 2 = 0 group by v - 501 > 0 order by sum(abs(v - 500)), v - 501 > 0 limit 10;
 ?column? |   sum   
----------+---------
 f        |  311752
 t        | 1221687
 $        |       $

reset timescaledb.debug_require_vector_agg;
reset timescaledb.enable_vectorized_aggregation;
reset timescaledb.enable_decompression_sorted_merge;
