-- This file and its contents are licensed under the Timescale License.
-- Please see the included NOTICE for copyright information and
-- LICENSE-TIMESCALE for a copy of the license.
-- need superuser to modify statistics
\c :TEST_DBNAME :ROLE_CLUSTER_SUPERUSER
\ir include/skip_scan_load.sql
-- This file and its contents are licensed under the Timescale License.
-- Please see the included NOTICE for copyright information and
-- LICENSE-TIMESCALE for a copy of the license.
CREATE TABLE skip_scan(time int, dev int, dev_name text, val int);
INSERT INTO skip_scan SELECT t, d, 'device_' || d::text, t*d FROM generate_series(1, 1000) t, generate_series(1, 10) d;
INSERT INTO skip_scan VALUES (NULL, 0, -1, NULL), (0, NULL, -1, NULL);
INSERT INTO skip_scan(time,dev,dev_name,val) SELECT t, NULL, NULL, NULL FROM generate_series(0, 999, 50) t;
ANALYZE skip_scan;
CREATE TABLE skip_scan_nulls(time int);
CREATE INDEX ON skip_scan_nulls(time);
INSERT INTO skip_scan_nulls SELECT NULL FROM generate_series(1,100);
ANALYZE skip_scan_nulls;
-- create hypertable with different physical layouts in the chunks
CREATE TABLE skip_scan_ht(f1 int, f2 int, f3 int, time int NOT NULL, dev int, dev_name text, val int);
SELECT create_hypertable('skip_scan_ht', 'time', chunk_time_interval => 250, create_default_indexes => false);
     create_hypertable     
---------------------------
 (1,public,skip_scan_ht,t)
(1 row)

INSERT INTO skip_scan_ht(time,dev,dev_name,val) SELECT t, d, 'device_' || d::text, random() FROM generate_series(0, 249) t, generate_series(1, 10) d;
ALTER TABLE skip_scan_ht DROP COLUMN f1;
INSERT INTO skip_scan_ht(time,dev,dev_name,val) SELECT t, d, 'device_' || d::text, random() FROM generate_series(250, 499) t, generate_series(1, 10) d;
ALTER TABLE skip_scan_ht DROP COLUMN f2;
INSERT INTO skip_scan_ht(time,dev,dev_name,val) SELECT t, d, 'device_' || d::text, random() FROM generate_series(500, 749) t, generate_series(1, 10) d;
ALTER TABLE skip_scan_ht DROP COLUMN f3;
INSERT INTO skip_scan_ht(time,dev,dev_name,val) SELECT t, d, 'device_' || d::text, random() FROM generate_series(750, 999) t, generate_series(1, 10) d;
INSERT INTO skip_scan_ht(time,dev,dev_name,val) SELECT t, NULL, NULL, NULL FROM generate_series(0, 999, 50) t;
ANALYZE skip_scan_ht;
ALTER TABLE skip_scan_ht SET (timescaledb.compress,timescaledb.compress_orderby='time desc', timescaledb.compress_segmentby='dev');
CREATE TABLE skip_scan_insert(time int, dev int, dev_name text, val int, query text);
CREATE OR REPLACE FUNCTION int_func_immutable() RETURNS int LANGUAGE SQL IMMUTABLE SECURITY DEFINER AS $$SELECT 1; $$;
CREATE OR REPLACE FUNCTION int_func_stable() RETURNS int LANGUAGE SQL STABLE SECURITY DEFINER AS $$ SELECT 2; $$;
CREATE OR REPLACE FUNCTION int_func_volatile() RETURNS int LANGUAGE SQL VOLATILE SECURITY DEFINER AS $$ SELECT 3; $$;
CREATE OR REPLACE FUNCTION inta_func_immutable() RETURNS int[] LANGUAGE SQL IMMUTABLE SECURITY DEFINER AS $$ SELECT ARRAY[1,2,3]; $$;
CREATE OR REPLACE FUNCTION inta_func_stable() RETURNS int[] LANGUAGE SQL STABLE SECURITY DEFINER AS $$ SELECT ARRAY[2,3,4]; $$;
CREATE OR REPLACE FUNCTION inta_func_volatile() RETURNS int[] LANGUAGE SQL VOLATILE SECURITY DEFINER AS $$ SELECT ARRAY[3,4,5]; $$;
-- adjust statistics so we get skipscan plans
UPDATE pg_statistic SET stadistinct=1, stanullfrac=0.5 WHERE starelid='skip_scan'::regclass;
UPDATE pg_statistic SET stadistinct=1, stanullfrac=0.5 WHERE starelid='skip_scan_nulls'::regclass;
UPDATE pg_statistic SET stadistinct=1, stanullfrac=0.5 WHERE starelid='skip_scan_ht'::regclass;
UPDATE pg_statistic SET stadistinct=1, stanullfrac=0.5 WHERE starelid IN (select inhrelid from pg_inherits where inhparent='skip_scan_ht'::regclass);
-- we want to run with analyze here so we can see counts in the nodes
\set PREFIX 'EXPLAIN (analyze, costs off, timing off, summary off)'
\set TABLE skip_scan
\ir include/skip_scan_query-13.sql
-- This file and its contents are licensed under the Timescale License.
-- Please see the included NOTICE for copyright information and
-- LICENSE-TIMESCALE for a copy of the license.
-- canary for result diff
SELECT current_setting('timescaledb.enable_skipscan') AS enable_skipscan;
 enable_skipscan 
-----------------
 on
(1 row)

-- test different index configurations
-- no index so we cant do SkipScan
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                          QUERY PLAN                           
---------------------------------------------------------------
 Sort (actual rows=12 loops=1)
   Sort Key: dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=12 loops=1)
         Group Key: dev
         Batches: 1 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(7 rows)

-- NULLS LAST index on dev
CREATE INDEX skip_scan_idx_dev_nulls_last ON :TABLE(dev);
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_idx_dev_nulls_last on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev DESC;
                                                  QUERY PLAN                                                   
---------------------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan Backward using skip_scan_idx_dev_nulls_last on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev < NULL::integer)
               Heap Fetches: 12
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_idx_dev_nulls_last on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

DROP INDEX skip_scan_idx_dev_nulls_last;
-- NULLS FIRST index on dev
CREATE INDEX skip_scan_idx_dev_nulls_first ON :TABLE(dev NULLS FIRST);
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev NULLS FIRST;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_idx_dev_nulls_first on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev NULLS FIRST;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_idx_dev_nulls_first on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

DROP INDEX skip_scan_idx_dev_nulls_first;
-- multicolumn index with dev as leading column
CREATE INDEX skip_scan_idx_dev_time_idx ON :TABLE(dev, time);
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_idx_dev_time_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE;
                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_idx_dev_time_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev DESC, time DESC;
                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan Backward using skip_scan_idx_dev_time_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev < NULL::integer)
               Heap Fetches: 12
(5 rows)

DROP INDEX skip_scan_idx_dev_time_idx;
-- multicolumn index with dev as non-leading column
CREATE INDEX skip_scan_idx_time_dev_idx ON :TABLE(time, dev);
:PREFIX SELECT DISTINCT dev FROM :TABLE WHERE time = 100 ORDER BY dev;
                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=11 loops=1)
         ->  Index Only Scan using skip_scan_idx_time_dev_idx on skip_scan (actual rows=11 loops=1)
               Index Cond: (("time" = 100) AND (dev > NULL::integer))
               Heap Fetches: 11
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time = 100;
                                             QUERY PLAN                                             
----------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=11 loops=1)
         ->  Index Only Scan using skip_scan_idx_time_dev_idx on skip_scan (actual rows=11 loops=1)
               Index Cond: (("time" = 100) AND (dev > NULL::integer))
               Heap Fetches: 11
(5 rows)

DROP INDEX skip_scan_idx_time_dev_idx;
-- hash index is not ordered so can't use skipscan
CREATE INDEX skip_scan_idx_hash ON :TABLE USING hash(dev_name);
:PREFIX SELECT DISTINCT dev_name FROM :TABLE WHERE dev_name IN ('device_1','device_2') ORDER BY dev_name;
                                      QUERY PLAN                                      
--------------------------------------------------------------------------------------
 Sort (actual rows=2 loops=1)
   Sort Key: dev_name
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=2 loops=1)
         Group Key: dev_name
         Batches: 1 
         ->  Bitmap Heap Scan on skip_scan (actual rows=2000 loops=1)
               Recheck Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
               Heap Blocks: exact=13
               ->  Bitmap Index Scan on skip_scan_idx_hash (actual rows=2000 loops=1)
                     Index Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
(11 rows)

DROP INDEX skip_scan_idx_hash;
-- expression indexes
-- currently not supported by skipscan
CREATE INDEX skip_scan_expr_idx ON :TABLE((dev % 3));
:PREFIX SELECT DISTINCT dev%3 FROM :TABLE ORDER BY dev%3;
                          QUERY PLAN                           
---------------------------------------------------------------
 Sort (actual rows=4 loops=1)
   Sort Key: ((dev % 3))
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=4 loops=1)
         Group Key: (dev % 3)
         Batches: 1 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(7 rows)

:PREFIX SELECT DISTINCT ON (dev%3) dev FROM :TABLE ORDER BY dev%3;
                                     QUERY PLAN                                     
------------------------------------------------------------------------------------
 Unique (actual rows=4 loops=1)
   ->  Index Scan using skip_scan_expr_idx on skip_scan (actual rows=10022 loops=1)
(2 rows)

DROP INDEX skip_scan_expr_idx;
CREATE INDEX ON :TABLE(dev_name);
CREATE INDEX ON :TABLE(dev);
CREATE INDEX ON :TABLE(dev, time);
CREATE INDEX ON :TABLE(time,dev);
CREATE INDEX ON :TABLE(time,dev,val);
\qecho basic DISTINCT queries on :TABLE
basic DISTINCT queries on skip_scan
:PREFIX SELECT DISTINCT dev, 'q1_1' FROM :TABLE ORDER BY dev;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT dev_name, 'q1_2' FROM :TABLE ORDER BY dev_name;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT dev, 'q1_3', NULL FROM :TABLE ORDER BY dev;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

\qecho stable expression in targetlist on :TABLE
stable expression in targetlist on skip_scan
:PREFIX SELECT DISTINCT dev, 'q1_4', length(md5(now()::text)) FROM :TABLE ORDER BY dev;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT dev_name, 'q1_5', length(md5(now()::text)) FROM :TABLE ORDER BY dev_name;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

-- volatile expression in targetlist
:PREFIX SELECT DISTINCT dev, 'q1_6', length(md5(random()::text)) FROM :TABLE ORDER BY dev;
                          QUERY PLAN                           
---------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Sort (actual rows=10022 loops=1)
         Sort Key: dev, (length(md5((random())::text)))
         Sort Method: quicksort 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(5 rows)

:PREFIX SELECT DISTINCT dev_name, 'q1_7', length(md5(random()::text)) FROM :TABLE ORDER BY dev_name;
                          QUERY PLAN                           
---------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Sort (actual rows=10022 loops=1)
         Sort Key: dev_name, (length(md5((random())::text)))
         Sort Method: quicksort 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(5 rows)

-- queries without skipscan because distinct is not limited to specific column
:PREFIX SELECT DISTINCT * FROM :TABLE ORDER BY dev;
                          QUERY PLAN                           
---------------------------------------------------------------
 Sort (actual rows=10022 loops=1)
   Sort Key: dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=10022 loops=1)
         Group Key: dev, "time", dev_name, val
         Batches: 1 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(7 rows)

:PREFIX SELECT DISTINCT *, 'q1_9' FROM :TABLE ORDER BY dev;
                          QUERY PLAN                           
---------------------------------------------------------------
 Sort (actual rows=10022 loops=1)
   Sort Key: dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=10022 loops=1)
         Group Key: dev, "time", dev_name, val, 'q1_9'::text
         Batches: 1 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(7 rows)

:PREFIX SELECT DISTINCT dev, time, 'q1_10' FROM :TABLE ORDER BY dev;
                          QUERY PLAN                           
---------------------------------------------------------------
 Sort (actual rows=10021 loops=1)
   Sort Key: dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=10021 loops=1)
         Group Key: dev, "time", 'q1_10'::text
         Batches: 1 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(7 rows)

:PREFIX SELECT DISTINCT dev, NULL, 'q1_11' FROM :TABLE ORDER BY dev;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

-- distinct on expressions not supported
:PREFIX SELECT DISTINCT time_bucket(10,time), 'q1_12' FROM :TABLE;
                       QUERY PLAN                        
---------------------------------------------------------
 HashAggregate (actual rows=102 loops=1)
   Group Key: time_bucket(10, "time"), 'q1_12'::text
   Batches: 1 
   ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT length(dev_name), 'q1_13' FROM :TABLE;
                       QUERY PLAN                        
---------------------------------------------------------
 HashAggregate (actual rows=4 loops=1)
   Group Key: length(dev_name), 'q1_13'::text
   Batches: 1 
   ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT 3*time, 'q1_14' FROM :TABLE;
                       QUERY PLAN                        
---------------------------------------------------------
 HashAggregate (actual rows=1002 loops=1)
   Group Key: (3 * "time"), 'q1_14'::text
   Batches: 1 
   ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT 'Device ' || dev_name FROM :TABLE;
                       QUERY PLAN                        
---------------------------------------------------------
 HashAggregate (actual rows=12 loops=1)
   Group Key: ('Device '::text || dev_name)
   Batches: 1 
   ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(4 rows)

-- DISTINCT ON queries
:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_2' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_3', NULL FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_4', length(md5(now()::text)) FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_5', length(md5(random()::text)) FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE;
                                      QUERY PLAN                                      
--------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(3 rows)

:PREFIX SELECT DISTINCT ON (dev) *, 'q2_7' FROM :TABLE;
                                         QUERY PLAN                                         
--------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, time, 'q2_8' FROM :TABLE;
                                         QUERY PLAN                                         
--------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, NULL, 'q2_9' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) time, 'q2_10' FROM :TABLE ORDER by dev, time;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, tableoid::regclass, 'q2_11' FROM :TABLE;
                                         QUERY PLAN                                         
--------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, int_func_immutable(), 'q2_12' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, int_func_stable(), 'q2_13' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, int_func_volatile(), 'q2_14' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

-- DISTINCT ON queries on TEXT column
:PREFIX SELECT DISTINCT ON (dev_name) dev_name FROM :TABLE;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev_name > NULL::text)
               Heap Fetches: 12
(5 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_2' FROM :TABLE;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_3', NULL FROM :TABLE;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_4', length(md5(now()::text)) FROM :TABLE;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_5', length(md5(random()::text)) FROM :TABLE;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev_name) * FROM :TABLE;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
(3 rows)

:PREFIX SELECT DISTINCT ON (dev_name) *, 'q3_7' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, time, 'q3_8' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, NULL, 'q3_9' FROM :TABLE;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev_name) time, 'q3_10' FROM :TABLE ORDER by dev_name, time;
                          QUERY PLAN                           
---------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Sort (actual rows=10022 loops=1)
         Sort Key: dev_name, "time"
         Sort Method: quicksort 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(5 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, tableoid::regclass, 'q3_11' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev_name::varchar) dev_name::varchar FROM :TABLE;
                                              QUERY PLAN                                              
------------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev, int_func_immutable(), 'q3_13' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev, int_func_stable(), 'q3_14' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev, int_func_volatile(), 'q3_15' FROM :TABLE;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Result (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

\qecho DISTINCT with wholerow var
DISTINCT with wholerow var
:PREFIX SELECT DISTINCT ON (dev) :TABLE FROM :TABLE;
                                      QUERY PLAN                                      
--------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(3 rows)

-- should not use SkipScan since we only support SkipScan on single-column distinct
:PREFIX SELECT DISTINCT :TABLE FROM :TABLE;
                          QUERY PLAN                           
---------------------------------------------------------------
 Unique (actual rows=10022 loops=1)
   ->  Sort (actual rows=10022 loops=1)
         Sort Key: skip_scan.*
         Sort Method: quicksort 
         ->  Seq Scan on skip_scan (actual rows=10022 loops=1)
(5 rows)

\qecho LIMIT queries on :TABLE
LIMIT queries on skip_scan
:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE LIMIT 3;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Limit (actual rows=3 loops=1)
   ->  Unique (actual rows=3 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=3 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=3 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 3
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev DESC, time DESC LIMIT 3;
                                                  QUERY PLAN                                                  
--------------------------------------------------------------------------------------------------------------
 Limit (actual rows=3 loops=1)
   ->  Unique (actual rows=3 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=3 loops=1)
               ->  Index Only Scan Backward using skip_scan_dev_time_idx on skip_scan (actual rows=3 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 3
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev, time LIMIT 3;
                                             QUERY PLAN                                              
-----------------------------------------------------------------------------------------------------
 Limit (actual rows=3 loops=1)
   ->  Unique (actual rows=3 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=3 loops=1)
               ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan (actual rows=3 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 3
(6 rows)

\qecho range queries on :TABLE
range queries on skip_scan
:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time BETWEEN 100 AND 300;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=11 loops=1)
         ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan (actual rows=11 loops=1)
               Index Cond: ((dev > NULL::integer) AND ("time" >= 100) AND ("time" <= 300))
               Heap Fetches: 11
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time < 200;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=11 loops=1)
         ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan (actual rows=11 loops=1)
               Index Cond: ((dev > NULL::integer) AND ("time" < 200))
               Heap Fetches: 11
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time > 800;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=11 loops=1)
         ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan (actual rows=11 loops=1)
               Index Cond: ((dev > NULL::integer) AND ("time" > 800))
               Heap Fetches: 11
(5 rows)

\qecho ordered append on :TABLE
ordered append on skip_scan
:PREFIX SELECT * FROM :TABLE ORDER BY time;
                                    QUERY PLAN                                    
----------------------------------------------------------------------------------
 Index Scan using skip_scan_time_dev_idx on skip_scan (actual rows=10022 loops=1)
(1 row)

:PREFIX SELECT DISTINCT ON (time) time FROM :TABLE WHERE time BETWEEN 0 AND 5000;
                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Unique (actual rows=1001 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=1001 loops=1)
         ->  Index Only Scan using skip_scan_time_dev_idx on skip_scan (actual rows=1001 loops=1)
               Index Cond: (("time" > NULL::integer) AND ("time" >= 0) AND ("time" <= 5000))
               Heap Fetches: 1001
(5 rows)

\qecho SUBSELECTS on :TABLE
SUBSELECTS on skip_scan
:PREFIX SELECT time, dev, val, 'q4_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a;
                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=12 loops=1)
   ->  Result (actual rows=12 loops=1)
         ->  Unique (actual rows=12 loops=1)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
                     ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(5 rows)

:PREFIX SELECT NULL, dev, NULL, 'q4_3' FROM (SELECT DISTINCT ON (dev) dev FROM :TABLE) a;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
(6 rows)

:PREFIX SELECT time, dev, NULL, 'q4_4' FROM (SELECT DISTINCT ON (dev) dev, time FROM :TABLE) a;
                                         QUERY PLAN                                         
--------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=12 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(4 rows)

\qecho ORDER BY
ORDER BY
:PREFIX SELECT time, dev, val, 'q5_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE ORDER BY dev, time) a;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=12 loops=1)
   ->  Result (actual rows=12 loops=1)
         ->  Unique (actual rows=12 loops=1)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
                     ->  Index Scan using skip_scan_dev_time_idx on skip_scan (actual rows=12 loops=1)
(5 rows)

:PREFIX SELECT time, dev, val, 'q5_2' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE ORDER BY dev DESC, time DESC) a;
                                                   QUERY PLAN                                                   
----------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=12 loops=1)
   ->  Result (actual rows=12 loops=1)
         ->  Unique (actual rows=12 loops=1)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
                     ->  Index Scan Backward using skip_scan_dev_time_idx on skip_scan (actual rows=12 loops=1)
(5 rows)

\qecho WHERE CLAUSES
WHERE CLAUSES
:PREFIX SELECT time, dev, val, 'q6_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > 5) a;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=5 loops=1)
   ->  Result (actual rows=5 loops=1)
         ->  Unique (actual rows=5 loops=1)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=5 loops=1)
                     ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=5 loops=1)
                           Index Cond: (dev > 5)
(6 rows)

:PREFIX SELECT time, dev, val, 'q6_2' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE time > 5) a;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Result (actual rows=11 loops=1)
         ->  Unique (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=11 loops=1)
                     ->  Index Scan using skip_scan_dev_time_idx on skip_scan (actual rows=11 loops=1)
                           Index Cond: ("time" > 5)
(6 rows)

:PREFIX SELECT time, dev, val, 'q6_3' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a WHERE dev > 5;
                                           QUERY PLAN                                            
-------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=5 loops=1)
   ->  Result (actual rows=5 loops=1)
         ->  Unique (actual rows=5 loops=1)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=5 loops=1)
                     ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=5 loops=1)
                           Index Cond: (dev > 5)
(6 rows)

:PREFIX SELECT time, dev, val, 'q6_4' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a WHERE time > 5;
                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=0 loops=1)
   Filter: (a."time" > 5)
   Rows Removed by Filter: 12
   ->  Result (actual rows=12 loops=1)
         ->  Unique (actual rows=12 loops=1)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
                     ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(7 rows)

--\qecho immutable func in WHERE clause on :TABLE
:PREFIX SELECT DISTINCT ON (dev) *, 'q6_5' FROM :TABLE WHERE dev > int_func_immutable();
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Result (actual rows=9 loops=1)
   ->  Unique (actual rows=9 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=9 loops=1)
               ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=9 loops=1)
                     Index Cond: (dev > 1)
(5 rows)

--\qecho stable func in WHERE clause on :TABLE
:PREFIX SELECT DISTINCT ON (dev) *, 'q6_6' FROM :TABLE WHERE dev > int_func_stable();
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Result (actual rows=8 loops=1)
   ->  Unique (actual rows=8 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=8 loops=1)
               ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=8 loops=1)
                     Index Cond: (dev > int_func_stable())
(5 rows)

--\qecho volatile func in WHERE clause on :TABLE
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > int_func_volatile();
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Unique (actual rows=7 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=7 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=7 loops=1)
               Filter: (dev > int_func_volatile())
               Rows Removed by Filter: 3022
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = ANY(inta_func_immutable());
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Unique (actual rows=3 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=3 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=3 loops=1)
               Index Cond: (dev = ANY ('{1,2,3}'::integer[]))
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = ANY(inta_func_stable());
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Unique (actual rows=3 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=3 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=3 loops=1)
               Index Cond: (dev = ANY (inta_func_stable()))
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = ANY(inta_func_volatile());
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Unique (actual rows=3 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=3 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=3 loops=1)
               Filter: (dev = ANY (inta_func_volatile()))
               Rows Removed by Filter: 7022
(5 rows)

-- RowCompareExpr
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE (dev, time) > (5,100);
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Unique (actual rows=6 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=6 loops=1)
         ->  Index Scan using skip_scan_dev_time_idx on skip_scan (actual rows=6 loops=1)
               Index Cond: (ROW(dev, "time") > ROW(5, 100))
(4 rows)

-- always false expr similar to our initial skip qual
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > NULL;
                  QUERY PLAN                  
----------------------------------------------
 Unique (actual rows=0 loops=1)
   ->  Sort (actual rows=0 loops=1)
         Sort Key: dev
         Sort Method: quicksort 
         ->  Result (actual rows=0 loops=1)
               One-Time Filter: false
(6 rows)

-- no tuples matching
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > 20;
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Unique (actual rows=0 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=0 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=0 loops=1)
               Index Cond: (dev > 20)
(4 rows)

-- multiple constraints in WHERE clause
:PREFIX SELECT DISTINCT ON (dev) dev,time FROM :TABLE WHERE dev > 5 AND time = 100;
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Unique (actual rows=5 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=5 loops=1)
         ->  Index Only Scan using skip_scan_time_dev_val_idx on skip_scan (actual rows=5 loops=1)
               Index Cond: (("time" = 100) AND (dev > NULL::integer) AND (dev > 5))
               Heap Fetches: 5
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev,time FROM :TABLE WHERE dev > 5 AND time > 200;
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Unique (actual rows=5 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=5 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=5 loops=1)
               Index Cond: (dev > 5)
               Filter: ("time" > 200)
               Rows Removed by Filter: 1000
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev,time FROM :TABLE WHERE dev >= 5 AND dev < 7 AND dev >= 2;
                                     QUERY PLAN                                      
-------------------------------------------------------------------------------------
 Unique (actual rows=2 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=2 loops=1)
         ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=2 loops=1)
               Index Cond: ((dev >= 5) AND (dev < 7) AND (dev >= 2))
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) dev,time,val FROM :TABLE WHERE time > 100 AND time < 200 AND val > 10 AND val < 10000 AND dev > 2 AND dev < 7 ORDER BY dev,time;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Unique (actual rows=4 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=4 loops=1)
         ->  Index Scan using skip_scan_dev_time_idx on skip_scan (actual rows=4 loops=1)
               Index Cond: ((dev > 2) AND (dev < 7) AND ("time" > 100) AND ("time" < 200))
               Filter: ((val > 10) AND (val < 10000))
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE dev IS NULL;
                                        QUERY PLAN                                        
------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=1 loops=1)
         ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=1 loops=1)
               Index Cond: ((dev > NULL::integer) AND (dev IS NULL))
               Heap Fetches: 1
(5 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name FROM :TABLE WHERE dev_name IS NULL;
                                          QUERY PLAN                                           
-----------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=1 loops=1)
         ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=1 loops=1)
               Index Cond: ((dev_name > NULL::text) AND (dev_name IS NULL))
               Heap Fetches: 1
(5 rows)

-- test constants in ORDER BY
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = 1 ORDER BY dev, time DESC;
                                            QUERY PLAN                                             
---------------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=1 loops=1)
         ->  Index Scan Backward using skip_scan_dev_time_idx on skip_scan (actual rows=1 loops=1)
               Index Cond: (dev = 1)
(4 rows)

-- CTE
:PREFIX WITH devices AS (
	SELECT DISTINCT ON (dev) dev FROM :TABLE
)
SELECT * FROM devices;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

:PREFIX WITH devices AS (
	SELECT DISTINCT dev FROM :TABLE
)
SELECT * FROM devices ORDER BY dev;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

-- prepared statements
PREPARE prep AS SELECT DISTINCT ON (dev_name) dev_name FROM :TABLE;
:PREFIX EXECUTE prep;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev_name > NULL::text)
               Heap Fetches: 12
(5 rows)

:PREFIX EXECUTE prep;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev_name > NULL::text)
               Heap Fetches: 12
(5 rows)

:PREFIX EXECUTE prep;
                                           QUERY PLAN                                           
------------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev_name > NULL::text)
               Heap Fetches: 12
(5 rows)

DEALLOCATE prep;
-- ReScan tests
:PREFIX SELECT time, dev, val, 'q7_1' FROM (SELECT DISTINCT ON (dev) * FROM (
    VALUES (1), (2)) a(v),
    LATERAL (SELECT * FROM :TABLE WHERE time != a.v) b) a;
                                          QUERY PLAN                                           
-----------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Nested Loop (actual rows=20022 loops=1)
               Join Filter: (skip_scan."time" <> "*VALUES*".column1)
               Rows Removed by Join Filter: 22
               ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=10022 loops=1)
               ->  Materialize (actual rows=2 loops=10022)
                     ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
(8 rows)

:PREFIX SELECT time, dev, val, 'q7_2' FROM (SELECT * FROM (
    VALUES (1), (2)) a(v),
    LATERAL (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev != a.v) b) a;
                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=20 loops=1)
   ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
   ->  Result (actual rows=10 loops=2)
         ->  Unique (actual rows=10 loops=2)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=10 loops=2)
                     ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=10 loops=2)
                           Filter: (dev <> "*VALUES*".column1)
                           Rows Removed by Filter: 1021
(8 rows)

-- RuntimeKeys
:PREFIX SELECT time, dev, val, 'q8_1' FROM (SELECT * FROM (
    VALUES (1), (2)) a(v),
    LATERAL (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev >= a.v) b) c;
                                            QUERY PLAN                                            
--------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=19 loops=1)
   ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
   ->  Result (actual rows=10 loops=2)
         ->  Unique (actual rows=10 loops=2)
               ->  Custom Scan (SkipScan) on skip_scan (actual rows=10 loops=2)
                     ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=10 loops=2)
                           Index Cond: (dev >= "*VALUES*".column1)
(7 rows)

-- Emulate multi-column DISTINCT using multiple SkipSkans
:PREFIX SELECT time, dev, val, 'q9_1' FROM (SELECT b.* FROM
    (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
    LATERAL (SELECT DISTINCT ON (time) * FROM :TABLE WHERE dev = a.dev) b) c;
                                                     QUERY PLAN                                                      
---------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=10001 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
   ->  Result (actual rows=833 loops=12)
         ->  Unique (actual rows=833 loops=12)
               ->  Custom Scan (SkipScan) on skip_scan skip_scan_1 (actual rows=833 loops=12)
                     ->  Index Scan using skip_scan_dev_time_idx on skip_scan skip_scan_1 (actual rows=833 loops=12)
                           Index Cond: (dev = skip_scan.dev)
(11 rows)

:PREFIX SELECT time, dev, NULL, 'q9_2' FROM (SELECT b.* FROM
    (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
    LATERAL (SELECT DISTINCT ON (time) dev, time FROM :TABLE WHERE dev = a.dev) b) c;
                                                     QUERY PLAN                                                     
--------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=10001 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
   ->  Unique (actual rows=833 loops=12)
         ->  Custom Scan (SkipScan) on skip_scan skip_scan_1 (actual rows=833 loops=12)
               ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan skip_scan_1 (actual rows=833 loops=12)
                     Index Cond: ((dev = skip_scan.dev) AND ("time" > NULL::integer))
                     Heap Fetches: 10001
(11 rows)

-- Test that the multi-column DISTINCT emulation is equivalent to a real multi-column DISTINCT
:PREFIX SELECT * FROM
   (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
   LATERAL (SELECT DISTINCT ON (time) dev, time FROM :TABLE WHERE dev = a.dev) b;
                                                     QUERY PLAN                                                     
--------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=10001 loops=1)
   ->  Unique (actual rows=12 loops=1)
         ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
               ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 12
   ->  Unique (actual rows=833 loops=12)
         ->  Custom Scan (SkipScan) on skip_scan skip_scan_1 (actual rows=833 loops=12)
               ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan skip_scan_1 (actual rows=833 loops=12)
                     Index Cond: ((dev = skip_scan.dev) AND ("time" > NULL::integer))
                     Heap Fetches: 10001
(11 rows)

:PREFIX SELECT DISTINCT ON (dev, time) dev, time FROM :TABLE WHERE dev IS NOT NULL;
                                         QUERY PLAN                                          
---------------------------------------------------------------------------------------------
 Unique (actual rows=10001 loops=1)
   ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan (actual rows=10001 loops=1)
         Index Cond: (dev IS NOT NULL)
         Heap Fetches: 10001
(4 rows)

:PREFIX SELECT DISTINCT ON (dev, time) dev, time FROM :TABLE WHERE dev IS NOT NULL
UNION SELECT b.* FROM
   (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
   LATERAL (SELECT DISTINCT ON (time) dev, time FROM :TABLE WHERE dev = a.dev) b;
                                                              QUERY PLAN                                                              
--------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=10001 loops=1)
   ->  Sort (actual rows=20002 loops=1)
         Sort Key: skip_scan.dev, skip_scan."time"
         Sort Method: quicksort 
         ->  Append (actual rows=20002 loops=1)
               ->  Unique (actual rows=10001 loops=1)
                     ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan (actual rows=10001 loops=1)
                           Index Cond: (dev IS NOT NULL)
                           Heap Fetches: 10001
               ->  Nested Loop (actual rows=10001 loops=1)
                     ->  Unique (actual rows=12 loops=1)
                           ->  Custom Scan (SkipScan) on skip_scan skip_scan_1 (actual rows=12 loops=1)
                                 ->  Index Only Scan using skip_scan_dev_idx on skip_scan skip_scan_1 (actual rows=12 loops=1)
                                       Index Cond: (dev > NULL::integer)
                                       Heap Fetches: 12
                     ->  Unique (actual rows=833 loops=12)
                           ->  Custom Scan (SkipScan) on skip_scan skip_scan_2 (actual rows=833 loops=12)
                                 ->  Index Only Scan using skip_scan_dev_time_idx on skip_scan skip_scan_2 (actual rows=833 loops=12)
                                       Index Cond: ((dev = skip_scan_1.dev) AND ("time" > NULL::integer))
                                       Heap Fetches: 10001
(20 rows)

-- SkipScan into INSERT
:PREFIX INSERT INTO skip_scan_insert(time, dev, val, query) SELECT time, dev, val, 'q10_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a;
                                               QUERY PLAN                                               
--------------------------------------------------------------------------------------------------------
 Insert on skip_scan_insert (actual rows=0 loops=1)
   ->  Subquery Scan on a (actual rows=12 loops=1)
         ->  Result (actual rows=12 loops=1)
               ->  Unique (actual rows=12 loops=1)
                     ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
                           ->  Index Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
(6 rows)

-- parallel query
SET force_parallel_mode TO true;
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                                        QUERY PLAN                                         
-------------------------------------------------------------------------------------------
 Unique (actual rows=12 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan (actual rows=12 loops=1)
         ->  Index Only Scan using skip_scan_dev_idx on skip_scan (actual rows=12 loops=1)
               Index Cond: (dev > NULL::integer)
               Heap Fetches: 12
(5 rows)

RESET force_parallel_mode;
TRUNCATE skip_scan_insert;
-- table with only nulls
:PREFIX SELECT DISTINCT ON (time) time FROM skip_scan_nulls;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan_nulls (actual rows=1 loops=1)
         ->  Index Only Scan using skip_scan_nulls_time_idx on skip_scan_nulls (actual rows=1 loops=1)
               Index Cond: ("time" > NULL::integer)
               Heap Fetches: 1
(5 rows)

-- no tuples in resultset
:PREFIX SELECT DISTINCT ON (time) time FROM skip_scan_nulls WHERE time IS NOT NULL;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Unique (actual rows=0 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan_nulls (actual rows=0 loops=1)
         ->  Index Only Scan using skip_scan_nulls_time_idx on skip_scan_nulls (actual rows=0 loops=1)
               Index Cond: (("time" > NULL::integer) AND ("time" IS NOT NULL))
               Heap Fetches: 0
(5 rows)

\set TABLE skip_scan_ht
\ir include/skip_scan_query-13.sql
-- This file and its contents are licensed under the Timescale License.
-- Please see the included NOTICE for copyright information and
-- LICENSE-TIMESCALE for a copy of the license.
-- canary for result diff
SELECT current_setting('timescaledb.enable_skipscan') AS enable_skipscan;
 enable_skipscan 
-----------------
 on
(1 row)

-- test different index configurations
-- no index so we cant do SkipScan
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                                QUERY PLAN                                 
---------------------------------------------------------------------------
 Sort (actual rows=11 loops=1)
   Sort Key: _hyper_1_1_chunk.dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=11 loops=1)
         Group Key: _hyper_1_1_chunk.dev
         Batches: 1 
         ->  Append (actual rows=10020 loops=1)
               ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(11 rows)

-- NULLS LAST index on dev
CREATE INDEX skip_scan_idx_dev_nulls_last ON :TABLE(dev);
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                                                             QUERY PLAN                                                             
------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev DESC;
                                                                 QUERY PLAN                                                                  
---------------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev DESC
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_1_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_2_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_3_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_4_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
(19 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE;
                                                             QUERY PLAN                                                             
------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_idx_dev_nulls_last on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

DROP INDEX skip_scan_idx_dev_nulls_last;
-- NULLS FIRST index on dev
CREATE INDEX skip_scan_idx_dev_nulls_first ON :TABLE(dev NULLS FIRST);
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev NULLS FIRST;
                                                             QUERY PLAN                                                              
-------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev NULLS FIRST
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev NULLS FIRST;
                                                             QUERY PLAN                                                              
-------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev NULLS FIRST
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_idx_dev_nulls_first on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

DROP INDEX skip_scan_idx_dev_nulls_first;
-- multicolumn index with dev as leading column
CREATE INDEX skip_scan_idx_dev_time_idx ON :TABLE(dev, time);
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_idx_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_idx_dev_time_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_idx_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_idx_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_idx_dev_time_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_idx_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev DESC, time DESC;
                                                                QUERY PLAN                                                                 
-------------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev DESC, _hyper_1_1_chunk."time" DESC
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_1_chunk_skip_scan_idx_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_2_chunk_skip_scan_idx_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_3_chunk_skip_scan_idx_dev_time_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan Backward using _hyper_1_4_chunk_skip_scan_idx_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev < NULL::integer)
                     Heap Fetches: 11
(19 rows)

DROP INDEX skip_scan_idx_dev_time_idx;
-- multicolumn index with dev as non-leading column
CREATE INDEX skip_scan_idx_time_dev_idx ON :TABLE(time, dev);
:PREFIX SELECT DISTINCT dev FROM :TABLE WHERE time = 100 ORDER BY dev;
                                                      QUERY PLAN                                                      
----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_time_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
         Index Cond: ("time" = 100)
         Heap Fetches: 11
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time = 100;
                                                      QUERY PLAN                                                      
----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_idx_time_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
         Index Cond: ("time" = 100)
         Heap Fetches: 11
(4 rows)

DROP INDEX skip_scan_idx_time_dev_idx;
-- hash index is not ordered so can't use skipscan
CREATE INDEX skip_scan_idx_hash ON :TABLE USING hash(dev_name);
:PREFIX SELECT DISTINCT dev_name FROM :TABLE WHERE dev_name IN ('device_1','device_2') ORDER BY dev_name;
                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Sort (actual rows=2 loops=1)
   Sort Key: _hyper_1_1_chunk.dev_name
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=2 loops=1)
         Group Key: _hyper_1_1_chunk.dev_name
         Batches: 1 
         ->  Append (actual rows=2000 loops=1)
               ->  Bitmap Heap Scan on _hyper_1_1_chunk (actual rows=500 loops=1)
                     Recheck Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
                     Heap Blocks: exact=4
                     ->  Bitmap Index Scan on _hyper_1_1_chunk_skip_scan_idx_hash (actual rows=500 loops=1)
                           Index Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
               ->  Bitmap Heap Scan on _hyper_1_2_chunk (actual rows=500 loops=1)
                     Recheck Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
                     Heap Blocks: exact=4
                     ->  Bitmap Index Scan on _hyper_1_2_chunk_skip_scan_idx_hash (actual rows=500 loops=1)
                           Index Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
               ->  Bitmap Heap Scan on _hyper_1_3_chunk (actual rows=500 loops=1)
                     Recheck Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
                     Heap Blocks: exact=4
                     ->  Bitmap Index Scan on _hyper_1_3_chunk_skip_scan_idx_hash (actual rows=500 loops=1)
                           Index Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
               ->  Bitmap Heap Scan on _hyper_1_4_chunk (actual rows=500 loops=1)
                     Recheck Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
                     Heap Blocks: exact=4
                     ->  Bitmap Index Scan on _hyper_1_4_chunk_skip_scan_idx_hash (actual rows=500 loops=1)
                           Index Cond: (dev_name = ANY ('{device_1,device_2}'::text[]))
(27 rows)

DROP INDEX skip_scan_idx_hash;
-- expression indexes
-- currently not supported by skipscan
CREATE INDEX skip_scan_expr_idx ON :TABLE((dev % 3));
:PREFIX SELECT DISTINCT dev%3 FROM :TABLE ORDER BY dev%3;
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Sort (actual rows=4 loops=1)
   Sort Key: ((_hyper_1_1_chunk.dev % 3))
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=4 loops=1)
         Group Key: (_hyper_1_1_chunk.dev % 3)
         Batches: 1 
         ->  Result (actual rows=10020 loops=1)
               ->  Append (actual rows=10020 loops=1)
                     ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev%3) dev FROM :TABLE ORDER BY dev%3;
                                                   QUERY PLAN                                                    
-----------------------------------------------------------------------------------------------------------------
 Unique (actual rows=4 loops=1)
   ->  Merge Append (actual rows=10020 loops=1)
         Sort Key: ((_hyper_1_1_chunk.dev % 3))
         ->  Index Scan using _hyper_1_1_chunk_skip_scan_expr_idx on _hyper_1_1_chunk (actual rows=2505 loops=1)
         ->  Index Scan using _hyper_1_2_chunk_skip_scan_expr_idx on _hyper_1_2_chunk (actual rows=2505 loops=1)
         ->  Index Scan using _hyper_1_3_chunk_skip_scan_expr_idx on _hyper_1_3_chunk (actual rows=2505 loops=1)
         ->  Index Scan using _hyper_1_4_chunk_skip_scan_expr_idx on _hyper_1_4_chunk (actual rows=2505 loops=1)
(7 rows)

DROP INDEX skip_scan_expr_idx;
CREATE INDEX ON :TABLE(dev_name);
CREATE INDEX ON :TABLE(dev);
CREATE INDEX ON :TABLE(dev, time);
CREATE INDEX ON :TABLE(time,dev);
CREATE INDEX ON :TABLE(time,dev,val);
\qecho basic DISTINCT queries on :TABLE
basic DISTINCT queries on skip_scan_ht
:PREFIX SELECT DISTINCT dev, 'q1_1' FROM :TABLE ORDER BY dev;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT dev_name, 'q1_2' FROM :TABLE ORDER BY dev_name;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT dev, 'q1_3', NULL FROM :TABLE ORDER BY dev;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

\qecho stable expression in targetlist on :TABLE
stable expression in targetlist on skip_scan_ht
:PREFIX SELECT DISTINCT dev, 'q1_4', length(md5(now()::text)) FROM :TABLE ORDER BY dev;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT dev_name, 'q1_5', length(md5(now()::text)) FROM :TABLE ORDER BY dev_name;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

-- volatile expression in targetlist
:PREFIX SELECT DISTINCT dev, 'q1_6', length(md5(random()::text)) FROM :TABLE ORDER BY dev;
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Sort (actual rows=10020 loops=1)
         Sort Key: _hyper_1_1_chunk.dev, (length(md5((random())::text)))
         Sort Method: quicksort 
         ->  Result (actual rows=10020 loops=1)
               ->  Append (actual rows=10020 loops=1)
                     ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(10 rows)

:PREFIX SELECT DISTINCT dev_name, 'q1_7', length(md5(random()::text)) FROM :TABLE ORDER BY dev_name;
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Sort (actual rows=10020 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name, (length(md5((random())::text)))
         Sort Method: quicksort 
         ->  Result (actual rows=10020 loops=1)
               ->  Append (actual rows=10020 loops=1)
                     ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(10 rows)

-- queries without skipscan because distinct is not limited to specific column
:PREFIX SELECT DISTINCT * FROM :TABLE ORDER BY dev;
                                                    QUERY PLAN                                                     
-------------------------------------------------------------------------------------------------------------------
 Sort (actual rows=10020 loops=1)
   Sort Key: _hyper_1_1_chunk.dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=10020 loops=1)
         Group Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time", _hyper_1_1_chunk.dev_name, _hyper_1_1_chunk.val
         Batches: 1 
         ->  Append (actual rows=10020 loops=1)
               ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(11 rows)

:PREFIX SELECT DISTINCT *, 'q1_9' FROM :TABLE ORDER BY dev;
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Sort (actual rows=10020 loops=1)
   Sort Key: _hyper_1_1_chunk.dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=10020 loops=1)
         Group Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time", _hyper_1_1_chunk.dev_name, _hyper_1_1_chunk.val, 'q1_9'::text
         Batches: 1 
         ->  Result (actual rows=10020 loops=1)
               ->  Append (actual rows=10020 loops=1)
                     ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT dev, time, 'q1_10' FROM :TABLE ORDER BY dev;
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Sort (actual rows=10020 loops=1)
   Sort Key: _hyper_1_1_chunk.dev
   Sort Method: quicksort 
   ->  HashAggregate (actual rows=10020 loops=1)
         Group Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time", 'q1_10'::text
         Batches: 1 
         ->  Result (actual rows=10020 loops=1)
               ->  Append (actual rows=10020 loops=1)
                     ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT dev, NULL, 'q1_11' FROM :TABLE ORDER BY dev;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

-- distinct on expressions not supported
:PREFIX SELECT DISTINCT time_bucket(10,time), 'q1_12' FROM :TABLE;
                                QUERY PLAN                                 
---------------------------------------------------------------------------
 HashAggregate (actual rows=100 loops=1)
   Group Key: time_bucket(10, _hyper_1_1_chunk."time"), 'q1_12'::text
   Batches: 1 
   ->  Result (actual rows=10020 loops=1)
         ->  Append (actual rows=10020 loops=1)
               ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(9 rows)

:PREFIX SELECT DISTINCT length(dev_name), 'q1_13' FROM :TABLE;
                                QUERY PLAN                                 
---------------------------------------------------------------------------
 HashAggregate (actual rows=3 loops=1)
   Group Key: length(_hyper_1_1_chunk.dev_name), 'q1_13'::text
   Batches: 1 
   ->  Result (actual rows=10020 loops=1)
         ->  Append (actual rows=10020 loops=1)
               ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(9 rows)

:PREFIX SELECT DISTINCT 3*time, 'q1_14' FROM :TABLE;
                                QUERY PLAN                                 
---------------------------------------------------------------------------
 HashAggregate (actual rows=1000 loops=1)
   Group Key: (3 * _hyper_1_1_chunk."time"), 'q1_14'::text
   Batches: 1 
   ->  Result (actual rows=10020 loops=1)
         ->  Append (actual rows=10020 loops=1)
               ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(9 rows)

:PREFIX SELECT DISTINCT 'Device ' || dev_name FROM :TABLE;
                                QUERY PLAN                                 
---------------------------------------------------------------------------
 HashAggregate (actual rows=11 loops=1)
   Group Key: ('Device '::text || _hyper_1_1_chunk.dev_name)
   Batches: 1 
   ->  Result (actual rows=10020 loops=1)
         ->  Append (actual rows=10020 loops=1)
               ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(9 rows)

-- DISTINCT ON queries
:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE;
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_2' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_3', NULL FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_4', length(md5(now()::text)) FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, 'q2_5', length(md5(random()::text)) FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE;
                                                      QUERY PLAN                                                       
-----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(11 rows)

:PREFIX SELECT DISTINCT ON (dev) *, 'q2_7' FROM :TABLE;
                                                         QUERY PLAN                                                          
-----------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, time, 'q2_8' FROM :TABLE;
                                                         QUERY PLAN                                                          
-----------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, NULL, 'q2_9' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) time, 'q2_10' FROM :TABLE ORDER by dev, time;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time"
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, tableoid::regclass, 'q2_11' FROM :TABLE;
                                                         QUERY PLAN                                                          
-----------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, int_func_immutable(), 'q2_12' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, int_func_stable(), 'q2_13' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev, int_func_volatile(), 'q2_14' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

-- DISTINCT ON queries on TEXT column
:PREFIX SELECT DISTINCT ON (dev_name) dev_name FROM :TABLE;
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
(19 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_2' FROM :TABLE;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_3', NULL FROM :TABLE;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_4', length(md5(now()::text)) FROM :TABLE;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, 'q3_5', length(md5(random()::text)) FROM :TABLE;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev_name) * FROM :TABLE;
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(11 rows)

:PREFIX SELECT DISTINCT ON (dev_name) *, 'q3_7' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, time, 'q3_8' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, NULL, 'q3_9' FROM :TABLE;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev_name) time, 'q3_10' FROM :TABLE ORDER by dev_name, time;
                                   QUERY PLAN                                    
---------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Sort (actual rows=10020 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name, _hyper_1_1_chunk."time"
         Sort Method: quicksort 
         ->  Result (actual rows=10020 loops=1)
               ->  Append (actual rows=10020 loops=1)
                     ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
                     ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(10 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name, tableoid::regclass, 'q3_11' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev_name::varchar) dev_name::varchar FROM :TABLE;
                                                              QUERY PLAN                                                               
---------------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev_name > NULL::text)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev, int_func_immutable(), 'q3_13' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev, int_func_stable(), 'q3_14' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev, int_func_volatile(), 'q3_15' FROM :TABLE;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev_name
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

\qecho DISTINCT with wholerow var
DISTINCT with wholerow var
:PREFIX SELECT DISTINCT ON (dev) :TABLE FROM :TABLE;
                                                      QUERY PLAN                                                       
-----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(11 rows)

-- should not use SkipScan since we only support SkipScan on single-column distinct
:PREFIX SELECT DISTINCT :TABLE FROM :TABLE;
                                QUERY PLAN                                 
---------------------------------------------------------------------------
 Unique (actual rows=10020 loops=1)
   ->  Sort (actual rows=10020 loops=1)
         Sort Key: ((skip_scan_ht.*)::skip_scan_ht)
         Sort Method: quicksort 
         ->  Append (actual rows=10020 loops=1)
               ->  Seq Scan on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_2_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_3_chunk (actual rows=2505 loops=1)
               ->  Seq Scan on _hyper_1_4_chunk (actual rows=2505 loops=1)
(9 rows)

\qecho LIMIT queries on :TABLE
LIMIT queries on skip_scan_ht
:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE LIMIT 3;
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=3 loops=1)
   ->  Unique (actual rows=3 loops=1)
         ->  Merge Append (actual rows=9 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev DESC, time DESC LIMIT 3;
                                                                  QUERY PLAN                                                                   
-----------------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=3 loops=1)
   ->  Unique (actual rows=3 loops=1)
         ->  Merge Append (actual rows=9 loops=1)
               Sort Key: _hyper_1_1_chunk.dev DESC, _hyper_1_1_chunk."time" DESC
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan Backward using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=3 loops=1)
                           Index Cond: (dev < NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan Backward using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=3 loops=1)
                           Index Cond: (dev < NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan Backward using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=3 loops=1)
                           Index Cond: (dev < NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan Backward using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=3 loops=1)
                           Index Cond: (dev < NULL::integer)
                           Heap Fetches: 3
(20 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE ORDER BY dev, time LIMIT 3;
                                                              QUERY PLAN                                                              
--------------------------------------------------------------------------------------------------------------------------------------
 Limit (actual rows=3 loops=1)
   ->  Unique (actual rows=3 loops=1)
         ->  Merge Append (actual rows=9 loops=1)
               Sort Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time"
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=3 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=3 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 3
(20 rows)

\qecho range queries on :TABLE
range queries on skip_scan_ht
:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time BETWEEN 100 AND 300;
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=22 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: ((dev > NULL::integer) AND ("time" >= 100) AND ("time" <= 300))
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: ((dev > NULL::integer) AND ("time" >= 100) AND ("time" <= 300))
                     Heap Fetches: 11
(11 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time < 200;
                                                        QUERY PLAN                                                         
---------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
         ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               Index Cond: ((dev > NULL::integer) AND ("time" < 200))
               Heap Fetches: 11
(5 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE time > 800;
                                                        QUERY PLAN                                                         
---------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
         ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
               Index Cond: ((dev > NULL::integer) AND ("time" > 800))
               Heap Fetches: 11
(5 rows)

\qecho ordered append on :TABLE
ordered append on skip_scan_ht
:PREFIX SELECT * FROM :TABLE ORDER BY time;
                                                    QUERY PLAN                                                    
------------------------------------------------------------------------------------------------------------------
 Custom Scan (ChunkAppend) on skip_scan_ht (actual rows=10020 loops=1)
   Order: skip_scan_ht."time"
   ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_time_dev_idx on _hyper_1_1_chunk (actual rows=2505 loops=1)
   ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_time_dev_idx on _hyper_1_2_chunk (actual rows=2505 loops=1)
   ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_time_dev_idx on _hyper_1_3_chunk (actual rows=2505 loops=1)
   ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_time_dev_idx on _hyper_1_4_chunk (actual rows=2505 loops=1)
(6 rows)

:PREFIX SELECT DISTINCT ON (time) time FROM :TABLE WHERE time BETWEEN 0 AND 5000;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=1000 loops=1)
   ->  Merge Append (actual rows=1000 loops=1)
         Sort Key: _hyper_1_1_chunk."time"
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_time_dev_idx on _hyper_1_1_chunk (actual rows=250 loops=1)
                     Index Cond: (("time" > NULL::integer) AND ("time" >= 0) AND ("time" <= 5000))
                     Heap Fetches: 250
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_time_dev_idx on _hyper_1_2_chunk (actual rows=250 loops=1)
                     Index Cond: (("time" > NULL::integer) AND ("time" >= 0) AND ("time" <= 5000))
                     Heap Fetches: 250
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_time_dev_idx on _hyper_1_3_chunk (actual rows=250 loops=1)
                     Index Cond: (("time" > NULL::integer) AND ("time" >= 0) AND ("time" <= 5000))
                     Heap Fetches: 250
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_time_dev_idx on _hyper_1_4_chunk (actual rows=250 loops=1)
                     Index Cond: (("time" > NULL::integer) AND ("time" >= 0) AND ("time" <= 5000))
                     Heap Fetches: 250
(19 rows)

\qecho SUBSELECTS on :TABLE
SUBSELECTS on skip_scan_ht
:PREFIX SELECT time, dev, val, 'q4_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a;
                                                            QUERY PLAN                                                             
-----------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Result (actual rows=11 loops=1)
         ->  Unique (actual rows=11 loops=1)
               ->  Merge Append (actual rows=44 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(13 rows)

:PREFIX SELECT NULL, dev, NULL, 'q4_3' FROM (SELECT DISTINCT ON (dev) dev FROM :TABLE) a;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
(20 rows)

:PREFIX SELECT time, dev, NULL, 'q4_4' FROM (SELECT DISTINCT ON (dev) dev, time FROM :TABLE) a;
                                                         QUERY PLAN                                                          
-----------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(12 rows)

\qecho ORDER BY
ORDER BY
:PREFIX SELECT time, dev, val, 'q5_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE ORDER BY dev, time) a;
                                                               QUERY PLAN                                                               
----------------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Result (actual rows=11 loops=1)
         ->  Unique (actual rows=11 loops=1)
               ->  Merge Append (actual rows=44 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time"
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(13 rows)

:PREFIX SELECT time, dev, val, 'q5_2' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE ORDER BY dev DESC, time DESC) a;
                                                                   QUERY PLAN                                                                    
-------------------------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Result (actual rows=11 loops=1)
         ->  Unique (actual rows=11 loops=1)
               ->  Merge Append (actual rows=44 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev DESC, _hyper_1_1_chunk."time" DESC
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                           ->  Index Scan Backward using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                           ->  Index Scan Backward using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                           ->  Index Scan Backward using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                           ->  Index Scan Backward using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(13 rows)

\qecho WHERE CLAUSES
WHERE CLAUSES
:PREFIX SELECT time, dev, val, 'q6_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > 5) a;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=5 loops=1)
   ->  Result (actual rows=5 loops=1)
         ->  Unique (actual rows=5 loops=1)
               ->  Merge Append (actual rows=20 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
(17 rows)

:PREFIX SELECT time, dev, val, 'q6_2' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE time > 5) a;
                                                               QUERY PLAN                                                               
----------------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Result (actual rows=11 loops=1)
         ->  Unique (actual rows=11 loops=1)
               ->  Merge Append (actual rows=44 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                                 Index Cond: ("time" > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                                 Index Cond: ("time" > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                                 Index Cond: ("time" > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                                 Index Cond: ("time" > 5)
(17 rows)

:PREFIX SELECT time, dev, val, 'q6_3' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a WHERE dev > 5;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=5 loops=1)
   ->  Result (actual rows=5 loops=1)
         ->  Unique (actual rows=5 loops=1)
               ->  Merge Append (actual rows=20 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=5 loops=1)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=5 loops=1)
                                 Index Cond: (dev > 5)
(17 rows)

:PREFIX SELECT time, dev, val, 'q6_4' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a WHERE time > 5;
                                                            QUERY PLAN                                                             
-----------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=7 loops=1)
   Filter: (a."time" > 5)
   Rows Removed by Filter: 4
   ->  Result (actual rows=11 loops=1)
         ->  Unique (actual rows=11 loops=1)
               ->  Merge Append (actual rows=44 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(15 rows)

--\qecho immutable func in WHERE clause on :TABLE
:PREFIX SELECT DISTINCT ON (dev) *, 'q6_5' FROM :TABLE WHERE dev > int_func_immutable();
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=9 loops=1)
   ->  Unique (actual rows=9 loops=1)
         ->  Merge Append (actual rows=36 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=9 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=9 loops=1)
                           Index Cond: (dev > 1)
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=9 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=9 loops=1)
                           Index Cond: (dev > 1)
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=9 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=9 loops=1)
                           Index Cond: (dev > 1)
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=9 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=9 loops=1)
                           Index Cond: (dev > 1)
(16 rows)

--\qecho stable func in WHERE clause on :TABLE
:PREFIX SELECT DISTINCT ON (dev) *, 'q6_6' FROM :TABLE WHERE dev > int_func_stable();
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Result (actual rows=8 loops=1)
   ->  Unique (actual rows=8 loops=1)
         ->  Custom Scan (ConstraintAwareAppend) (actual rows=32 loops=1)
               Hypertable: skip_scan_ht
               Chunks excluded during startup: 0
               ->  Merge Append (actual rows=32 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=8 loops=1)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=8 loops=1)
                                 Index Cond: (dev > int_func_stable())
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=8 loops=1)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=8 loops=1)
                                 Index Cond: (dev > int_func_stable())
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=8 loops=1)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=8 loops=1)
                                 Index Cond: (dev > int_func_stable())
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=8 loops=1)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=8 loops=1)
                                 Index Cond: (dev > int_func_stable())
(19 rows)

--\qecho volatile func in WHERE clause on :TABLE
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > int_func_volatile();
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=7 loops=1)
   ->  Custom Scan (ConstraintAwareAppend) (actual rows=28 loops=1)
         Hypertable: skip_scan_ht
         Chunks excluded during startup: 0
         ->  Merge Append (actual rows=28 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=7 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=7 loops=1)
                           Filter: (dev > int_func_volatile())
                           Rows Removed by Filter: 755
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=7 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=7 loops=1)
                           Filter: (dev > int_func_volatile())
                           Rows Removed by Filter: 755
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=7 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=7 loops=1)
                           Filter: (dev > int_func_volatile())
                           Rows Removed by Filter: 755
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=7 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=7 loops=1)
                           Filter: (dev > int_func_volatile())
                           Rows Removed by Filter: 755
(22 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = ANY(inta_func_immutable());
                                                      QUERY PLAN                                                      
----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=3 loops=1)
   ->  Merge Append (actual rows=12 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=3 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=3 loops=1)
                     Index Cond: (dev = ANY ('{1,2,3}'::integer[]))
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=3 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=3 loops=1)
                     Index Cond: (dev = ANY ('{1,2,3}'::integer[]))
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=3 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=3 loops=1)
                     Index Cond: (dev = ANY ('{1,2,3}'::integer[]))
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=3 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=3 loops=1)
                     Index Cond: (dev = ANY ('{1,2,3}'::integer[]))
(15 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = ANY(inta_func_stable());
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=3 loops=1)
   ->  Custom Scan (ConstraintAwareAppend) (actual rows=12 loops=1)
         Hypertable: skip_scan_ht
         Chunks excluded during startup: 0
         ->  Merge Append (actual rows=12 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=3 loops=1)
                           Index Cond: (dev = ANY (inta_func_stable()))
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=3 loops=1)
                           Index Cond: (dev = ANY (inta_func_stable()))
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=3 loops=1)
                           Index Cond: (dev = ANY (inta_func_stable()))
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=3 loops=1)
                           Index Cond: (dev = ANY (inta_func_stable()))
(18 rows)

:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = ANY(inta_func_volatile());
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=3 loops=1)
   ->  Custom Scan (ConstraintAwareAppend) (actual rows=12 loops=1)
         Hypertable: skip_scan_ht
         Chunks excluded during startup: 0
         ->  Merge Append (actual rows=12 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=3 loops=1)
                           Filter: (dev = ANY (inta_func_volatile()))
                           Rows Removed by Filter: 1755
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=3 loops=1)
                           Filter: (dev = ANY (inta_func_volatile()))
                           Rows Removed by Filter: 1755
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=3 loops=1)
                           Filter: (dev = ANY (inta_func_volatile()))
                           Rows Removed by Filter: 1755
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=3 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=3 loops=1)
                           Filter: (dev = ANY (inta_func_volatile()))
                           Rows Removed by Filter: 1755
(22 rows)

-- RowCompareExpr
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE (dev, time) > (5,100);
                                                        QUERY PLAN                                                         
---------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=6 loops=1)
   ->  Merge Append (actual rows=24 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=6 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=6 loops=1)
                     Index Cond: (ROW(dev, "time") > ROW(5, 100))
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=6 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=6 loops=1)
                     Index Cond: (ROW(dev, "time") > ROW(5, 100))
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=6 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=6 loops=1)
                     Index Cond: (ROW(dev, "time") > ROW(5, 100))
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=6 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=6 loops=1)
                     Index Cond: (ROW(dev, "time") > ROW(5, 100))
(15 rows)

-- always false expr similar to our initial skip qual
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > NULL;
                  QUERY PLAN                  
----------------------------------------------
 Unique (actual rows=0 loops=1)
   ->  Sort (actual rows=0 loops=1)
         Sort Key: dev
         Sort Method: quicksort 
         ->  Result (actual rows=0 loops=1)
               One-Time Filter: false
(6 rows)

-- no tuples matching
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev > 20;
                                                      QUERY PLAN                                                      
----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=0 loops=1)
   ->  Merge Append (actual rows=0 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=0 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=0 loops=1)
                     Index Cond: (dev > 20)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=0 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=0 loops=1)
                     Index Cond: (dev > 20)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=0 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=0 loops=1)
                     Index Cond: (dev > 20)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=0 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=0 loops=1)
                     Index Cond: (dev > 20)
(15 rows)

-- multiple constraints in WHERE clause
:PREFIX SELECT DISTINCT ON (dev) dev,time FROM :TABLE WHERE dev > 5 AND time = 100;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=5 loops=1)
   ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_time_dev_val_idx on _hyper_1_1_chunk (actual rows=5 loops=1)
         Index Cond: (("time" = 100) AND (dev > 5))
         Heap Fetches: 5
(4 rows)

:PREFIX SELECT DISTINCT ON (dev) dev,time FROM :TABLE WHERE dev > 5 AND time > 200;
                                                           QUERY PLAN                                                           
--------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=5 loops=1)
   ->  Merge Append (actual rows=20 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=5 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=5 loops=1)
                     Index Cond: ((dev > NULL::integer) AND (dev > 5) AND ("time" > 200))
                     Heap Fetches: 5
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=5 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=5 loops=1)
                     Index Cond: (dev > 5)
                     Filter: ("time" > 200)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=5 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=5 loops=1)
                     Index Cond: (dev > 5)
                     Filter: ("time" > 200)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=5 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=5 loops=1)
                     Index Cond: (dev > 5)
                     Filter: ("time" > 200)
(19 rows)

:PREFIX SELECT DISTINCT ON (dev) dev,time FROM :TABLE WHERE dev >= 5 AND dev < 7 AND dev >= 2;
                                                      QUERY PLAN                                                      
----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=2 loops=1)
   ->  Merge Append (actual rows=8 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=2 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=2 loops=1)
                     Index Cond: ((dev >= 5) AND (dev < 7) AND (dev >= 2))
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=2 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=2 loops=1)
                     Index Cond: ((dev >= 5) AND (dev < 7) AND (dev >= 2))
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=2 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=2 loops=1)
                     Index Cond: ((dev >= 5) AND (dev < 7) AND (dev >= 2))
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=2 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=2 loops=1)
                     Index Cond: ((dev >= 5) AND (dev < 7) AND (dev >= 2))
(15 rows)

:PREFIX SELECT DISTINCT ON (dev) dev,time,val FROM :TABLE WHERE time > 100 AND time < 200 AND val > 10 AND val < 10000 AND dev > 2 AND dev < 7 ORDER BY dev,time;
                                                     QUERY PLAN                                                      
---------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=0 loops=1)
   ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=0 loops=1)
         ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=0 loops=1)
               Index Cond: ((dev > 2) AND (dev < 7) AND ("time" > 100) AND ("time" < 200))
               Filter: ((val > 10) AND (val < 10000))
               Rows Removed by Filter: 396
(6 rows)

:PREFIX SELECT DISTINCT ON (dev) dev FROM :TABLE WHERE dev IS NULL;
                                                        QUERY PLAN                                                         
---------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Merge Append (actual rows=4 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev > NULL::integer) AND (dev IS NULL))
                     Heap Fetches: 1
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev > NULL::integer) AND (dev IS NULL))
                     Heap Fetches: 1
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev > NULL::integer) AND (dev IS NULL))
                     Heap Fetches: 1
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev > NULL::integer) AND (dev IS NULL))
                     Heap Fetches: 1
(19 rows)

:PREFIX SELECT DISTINCT ON (dev_name) dev_name FROM :TABLE WHERE dev_name IS NULL;
                                                           QUERY PLAN                                                           
--------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Merge Append (actual rows=4 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev_name > NULL::text) AND (dev_name IS NULL))
                     Heap Fetches: 1
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev_name > NULL::text) AND (dev_name IS NULL))
                     Heap Fetches: 1
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev_name > NULL::text) AND (dev_name IS NULL))
                     Heap Fetches: 1
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=1 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=1 loops=1)
                     Index Cond: ((dev_name > NULL::text) AND (dev_name IS NULL))
                     Heap Fetches: 1
(19 rows)

-- test constants in ORDER BY
:PREFIX SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev = 1 ORDER BY dev, time DESC;
                                                             QUERY PLAN                                                             
------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Merge Append (actual rows=4 loops=1)
         Sort Key: _hyper_1_1_chunk."time" DESC
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=1 loops=1)
               ->  Index Scan Backward using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=1 loops=1)
                     Index Cond: (dev = 1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=1 loops=1)
               ->  Index Scan Backward using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=1 loops=1)
                     Index Cond: (dev = 1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=1 loops=1)
               ->  Index Scan Backward using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=1 loops=1)
                     Index Cond: (dev = 1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=1 loops=1)
               ->  Index Scan Backward using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=1 loops=1)
                     Index Cond: (dev = 1)
(15 rows)

-- CTE
:PREFIX WITH devices AS (
	SELECT DISTINCT ON (dev) dev FROM :TABLE
)
SELECT * FROM devices;
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

:PREFIX WITH devices AS (
	SELECT DISTINCT dev FROM :TABLE
)
SELECT * FROM devices ORDER BY dev;
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

-- prepared statements
PREPARE prep AS SELECT DISTINCT ON (dev_name) dev_name FROM :TABLE;
:PREFIX EXECUTE prep;
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
(19 rows)

:PREFIX EXECUTE prep;
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
(19 rows)

:PREFIX EXECUTE prep;
                                                           QUERY PLAN                                                            
---------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev_name
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev_name > NULL::text)
                     Heap Fetches: 11
(19 rows)

DEALLOCATE prep;
-- ReScan tests
:PREFIX SELECT time, dev, val, 'q7_1' FROM (SELECT DISTINCT ON (dev) * FROM (
    VALUES (1), (2)) a(v),
    LATERAL (SELECT * FROM :TABLE WHERE time != a.v) b) a;
                                                          QUERY PLAN                                                           
-------------------------------------------------------------------------------------------------------------------------------
 Subquery Scan on a (actual rows=11 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Nested Loop (actual rows=20020 loops=1)
               Join Filter: (_hyper_1_1_chunk."time" <> "*VALUES*".column1)
               Rows Removed by Join Filter: 20
               ->  Merge Append (actual rows=10020 loops=1)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=2505 loops=1)
                     ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=2505 loops=1)
                     ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=2505 loops=1)
                     ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=2505 loops=1)
               ->  Materialize (actual rows=2 loops=10020)
                     ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
(13 rows)

:PREFIX SELECT time, dev, val, 'q7_2' FROM (SELECT * FROM (
    VALUES (1), (2)) a(v),
    LATERAL (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev != a.v) b) a;
                                                            QUERY PLAN                                                            
----------------------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=18 loops=1)
   ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
   ->  Result (actual rows=9 loops=2)
         ->  Unique (actual rows=9 loops=2)
               ->  Merge Append (actual rows=36 loops=2)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=9 loops=2)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=9 loops=2)
                                 Filter: (dev <> "*VALUES*".column1)
                                 Rows Removed by Filter: 255
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=9 loops=2)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=9 loops=2)
                                 Filter: (dev <> "*VALUES*".column1)
                                 Rows Removed by Filter: 255
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=9 loops=2)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=9 loops=2)
                                 Filter: (dev <> "*VALUES*".column1)
                                 Rows Removed by Filter: 255
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=9 loops=2)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=9 loops=2)
                                 Filter: (dev <> "*VALUES*".column1)
                                 Rows Removed by Filter: 255
(22 rows)

-- RuntimeKeys
:PREFIX SELECT time, dev, val, 'q8_1' FROM (SELECT * FROM (
    VALUES (1), (2)) a(v),
    LATERAL (SELECT DISTINCT ON (dev) * FROM :TABLE WHERE dev >= a.v) b) c;
                                                            QUERY PLAN                                                             
-----------------------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=19 loops=1)
   ->  Values Scan on "*VALUES*" (actual rows=2 loops=1)
   ->  Result (actual rows=10 loops=2)
         ->  Unique (actual rows=10 loops=2)
               ->  Merge Append (actual rows=38 loops=2)
                     Sort Key: _hyper_1_1_chunk.dev
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=10 loops=2)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=10 loops=2)
                                 Index Cond: (dev >= "*VALUES*".column1)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=10 loops=2)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=10 loops=2)
                                 Index Cond: (dev >= "*VALUES*".column1)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=10 loops=2)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=10 loops=2)
                                 Index Cond: (dev >= "*VALUES*".column1)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=10 loops=2)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=10 loops=2)
                                 Index Cond: (dev >= "*VALUES*".column1)
(18 rows)

-- Emulate multi-column DISTINCT using multiple SkipSkans
:PREFIX SELECT time, dev, val, 'q9_1' FROM (SELECT b.* FROM
    (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
    LATERAL (SELECT DISTINCT ON (time) * FROM :TABLE WHERE dev = a.dev) b) c;
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=10000 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
   ->  Result (actual rows=909 loops=11)
         ->  Unique (actual rows=909 loops=11)
               ->  Merge Append (actual rows=909 loops=11)
                     Sort Key: _hyper_1_1_chunk_1."time"
                     ->  Custom Scan (SkipScan) on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=227 loops=11)
                           ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=227 loops=11)
                                 Index Cond: (dev = _hyper_1_1_chunk.dev)
                     ->  Custom Scan (SkipScan) on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=227 loops=11)
                           ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=227 loops=11)
                                 Index Cond: (dev = _hyper_1_1_chunk.dev)
                     ->  Custom Scan (SkipScan) on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=227 loops=11)
                           ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=227 loops=11)
                                 Index Cond: (dev = _hyper_1_1_chunk.dev)
                     ->  Custom Scan (SkipScan) on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=227 loops=11)
                           ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=227 loops=11)
                                 Index Cond: (dev = _hyper_1_1_chunk.dev)
(36 rows)

:PREFIX SELECT time, dev, NULL, 'q9_2' FROM (SELECT b.* FROM
    (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
    LATERAL (SELECT DISTINCT ON (time) dev, time FROM :TABLE WHERE dev = a.dev) b) c;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=10000 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
   ->  Unique (actual rows=909 loops=11)
         ->  Merge Append (actual rows=909 loops=11)
               Sort Key: _hyper_1_1_chunk_1."time"
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
(39 rows)

-- Test that the multi-column DISTINCT emulation is equivalent to a real multi-column DISTINCT
:PREFIX SELECT * FROM
   (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
   LATERAL (SELECT DISTINCT ON (time) dev, time FROM :TABLE WHERE dev = a.dev) b;
                                                                         QUERY PLAN                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------
 Nested Loop (actual rows=10000 loops=1)
   ->  Unique (actual rows=11 loops=1)
         ->  Merge Append (actual rows=44 loops=1)
               Sort Key: _hyper_1_1_chunk.dev
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                           Index Cond: (dev > NULL::integer)
                           Heap Fetches: 11
   ->  Unique (actual rows=909 loops=11)
         ->  Merge Append (actual rows=909 loops=11)
               Sort Key: _hyper_1_1_chunk_1."time"
               ->  Custom Scan (SkipScan) on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
               ->  Custom Scan (SkipScan) on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
               ->  Custom Scan (SkipScan) on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
               ->  Custom Scan (SkipScan) on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=227 loops=11)
                     ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=227 loops=11)
                           Index Cond: ((dev = _hyper_1_1_chunk.dev) AND ("time" > NULL::integer))
                           Heap Fetches: 2500
(39 rows)

:PREFIX SELECT DISTINCT ON (dev, time) dev, time FROM :TABLE WHERE dev IS NOT NULL;
                                                         QUERY PLAN                                                          
-----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=10000 loops=1)
   ->  Merge Append (actual rows=10000 loops=1)
         Sort Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time"
         ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=2500 loops=1)
               Index Cond: (dev IS NOT NULL)
               Heap Fetches: 2500
         ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=2500 loops=1)
               Index Cond: (dev IS NOT NULL)
               Heap Fetches: 2500
         ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=2500 loops=1)
               Index Cond: (dev IS NOT NULL)
               Heap Fetches: 2500
         ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=2500 loops=1)
               Index Cond: (dev IS NOT NULL)
               Heap Fetches: 2500
(15 rows)

:PREFIX SELECT DISTINCT ON (dev, time) dev, time FROM :TABLE WHERE dev IS NOT NULL
UNION SELECT b.* FROM
   (SELECT DISTINCT ON (dev) dev FROM :TABLE) a,
   LATERAL (SELECT DISTINCT ON (time) dev, time FROM :TABLE WHERE dev = a.dev) b;
                                                                                  QUERY PLAN                                                                                  
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=10000 loops=1)
   ->  Sort (actual rows=20000 loops=1)
         Sort Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time"
         Sort Method: quicksort 
         ->  Append (actual rows=20000 loops=1)
               ->  Unique (actual rows=10000 loops=1)
                     ->  Merge Append (actual rows=10000 loops=1)
                           Sort Key: _hyper_1_1_chunk.dev, _hyper_1_1_chunk."time"
                           ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk (actual rows=2500 loops=1)
                                 Index Cond: (dev IS NOT NULL)
                                 Heap Fetches: 2500
                           ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk (actual rows=2500 loops=1)
                                 Index Cond: (dev IS NOT NULL)
                                 Heap Fetches: 2500
                           ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk (actual rows=2500 loops=1)
                                 Index Cond: (dev IS NOT NULL)
                                 Heap Fetches: 2500
                           ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk (actual rows=2500 loops=1)
                                 Index Cond: (dev IS NOT NULL)
                                 Heap Fetches: 2500
               ->  Nested Loop (actual rows=10000 loops=1)
                     ->  Unique (actual rows=11 loops=1)
                           ->  Merge Append (actual rows=44 loops=1)
                                 Sort Key: _hyper_1_1_chunk_1.dev
                                 ->  Custom Scan (SkipScan) on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=11 loops=1)
                                       ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk _hyper_1_1_chunk_1 (actual rows=11 loops=1)
                                             Index Cond: (dev > NULL::integer)
                                             Heap Fetches: 11
                                 ->  Custom Scan (SkipScan) on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=11 loops=1)
                                       ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk _hyper_1_2_chunk_1 (actual rows=11 loops=1)
                                             Index Cond: (dev > NULL::integer)
                                             Heap Fetches: 11
                                 ->  Custom Scan (SkipScan) on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=11 loops=1)
                                       ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk _hyper_1_3_chunk_1 (actual rows=11 loops=1)
                                             Index Cond: (dev > NULL::integer)
                                             Heap Fetches: 11
                                 ->  Custom Scan (SkipScan) on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=11 loops=1)
                                       ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk _hyper_1_4_chunk_1 (actual rows=11 loops=1)
                                             Index Cond: (dev > NULL::integer)
                                             Heap Fetches: 11
                     ->  Unique (actual rows=909 loops=11)
                           ->  Merge Append (actual rows=909 loops=11)
                                 Sort Key: _hyper_1_1_chunk_2."time"
                                 ->  Custom Scan (SkipScan) on _hyper_1_1_chunk _hyper_1_1_chunk_2 (actual rows=227 loops=11)
                                       ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_time_idx on _hyper_1_1_chunk _hyper_1_1_chunk_2 (actual rows=227 loops=11)
                                             Index Cond: ((dev = _hyper_1_1_chunk_1.dev) AND ("time" > NULL::integer))
                                             Heap Fetches: 2500
                                 ->  Custom Scan (SkipScan) on _hyper_1_2_chunk _hyper_1_2_chunk_2 (actual rows=227 loops=11)
                                       ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_time_idx on _hyper_1_2_chunk _hyper_1_2_chunk_2 (actual rows=227 loops=11)
                                             Index Cond: ((dev = _hyper_1_1_chunk_1.dev) AND ("time" > NULL::integer))
                                             Heap Fetches: 2500
                                 ->  Custom Scan (SkipScan) on _hyper_1_3_chunk _hyper_1_3_chunk_2 (actual rows=227 loops=11)
                                       ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_time_idx on _hyper_1_3_chunk _hyper_1_3_chunk_2 (actual rows=227 loops=11)
                                             Index Cond: ((dev = _hyper_1_1_chunk_1.dev) AND ("time" > NULL::integer))
                                             Heap Fetches: 2500
                                 ->  Custom Scan (SkipScan) on _hyper_1_4_chunk _hyper_1_4_chunk_2 (actual rows=227 loops=11)
                                       ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_time_idx on _hyper_1_4_chunk _hyper_1_4_chunk_2 (actual rows=227 loops=11)
                                             Index Cond: ((dev = _hyper_1_1_chunk_1.dev) AND ("time" > NULL::integer))
                                             Heap Fetches: 2500
(59 rows)

-- SkipScan into INSERT
:PREFIX INSERT INTO skip_scan_insert(time, dev, val, query) SELECT time, dev, val, 'q10_1' FROM (SELECT DISTINCT ON (dev) * FROM :TABLE) a;
                                                               QUERY PLAN                                                                
-----------------------------------------------------------------------------------------------------------------------------------------
 Insert on skip_scan_insert (actual rows=0 loops=1)
   ->  Subquery Scan on a (actual rows=11 loops=1)
         ->  Result (actual rows=11 loops=1)
               ->  Unique (actual rows=11 loops=1)
                     ->  Merge Append (actual rows=44 loops=1)
                           Sort Key: _hyper_1_1_chunk.dev
                           ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
                                 ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                           ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
                                 ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                           ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
                                 ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                           ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
                                 ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
(14 rows)

-- parallel query
SET force_parallel_mode TO true;
:PREFIX SELECT DISTINCT dev FROM :TABLE ORDER BY dev;
                                                         QUERY PLAN                                                         
----------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx on _hyper_1_1_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx on _hyper_1_2_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx on _hyper_1_3_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx on _hyper_1_4_chunk (actual rows=11 loops=1)
                     Index Cond: (dev > NULL::integer)
                     Heap Fetches: 11
(19 rows)

RESET force_parallel_mode;
TRUNCATE skip_scan_insert;
-- table with only nulls
:PREFIX SELECT DISTINCT ON (time) time FROM skip_scan_nulls;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Unique (actual rows=1 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan_nulls (actual rows=1 loops=1)
         ->  Index Only Scan using skip_scan_nulls_time_idx on skip_scan_nulls (actual rows=1 loops=1)
               Index Cond: ("time" > NULL::integer)
               Heap Fetches: 1
(5 rows)

-- no tuples in resultset
:PREFIX SELECT DISTINCT ON (time) time FROM skip_scan_nulls WHERE time IS NOT NULL;
                                              QUERY PLAN                                               
-------------------------------------------------------------------------------------------------------
 Unique (actual rows=0 loops=1)
   ->  Custom Scan (SkipScan) on skip_scan_nulls (actual rows=0 loops=1)
         ->  Index Only Scan using skip_scan_nulls_time_idx on skip_scan_nulls (actual rows=0 loops=1)
               Index Cond: (("time" > NULL::integer) AND ("time" IS NOT NULL))
               Heap Fetches: 0
(5 rows)

\ir include/skip_scan_query_ht.sql
-- This file and its contents are licensed under the Timescale License.
-- Please see the included NOTICE for copyright information and
-- LICENSE-TIMESCALE for a copy of the license.
CREATE INDEX ON :TABLE(dev);
CREATE INDEX ON :TABLE(time);
-- SkipScan with ordered append
:PREFIX SELECT DISTINCT ON (time) time FROM :TABLE ORDER BY time;
                                                          QUERY PLAN                                                          
------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=1000 loops=1)
   ->  Custom Scan (ChunkAppend) on skip_scan_ht (actual rows=1000 loops=1)
         Order: skip_scan_ht."time"
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_time_idx on _hyper_1_1_chunk (actual rows=250 loops=1)
                     Index Cond: ("time" > NULL::integer)
                     Heap Fetches: 250
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_time_idx on _hyper_1_2_chunk (actual rows=250 loops=1)
                     Index Cond: ("time" > NULL::integer)
                     Heap Fetches: 250
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_time_idx on _hyper_1_3_chunk (actual rows=250 loops=1)
                     Index Cond: ("time" > NULL::integer)
                     Heap Fetches: 250
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=250 loops=1)
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_time_idx on _hyper_1_4_chunk (actual rows=250 loops=1)
                     Index Cond: ("time" > NULL::integer)
                     Heap Fetches: 250
(19 rows)

--baseline query with skipscan
:PREFIX SELECT DISTINCT ON (dev) dev, dev_name FROM :TABLE;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx1 on _hyper_1_1_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx1 on _hyper_1_2_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx1 on _hyper_1_3_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx1 on _hyper_1_4_chunk (actual rows=11 loops=1)
(11 rows)

-- compression doesnt prevent skipscan
SELECT compress_chunk('_timescaledb_internal._hyper_1_1_chunk');
             compress_chunk             
----------------------------------------
 _timescaledb_internal._hyper_1_1_chunk
(1 row)

:PREFIX SELECT DISTINCT ON (dev) dev, dev_name FROM :TABLE;
                                                                       QUERY PLAN                                                                        
---------------------------------------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=2538 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (DecompressChunk) on _hyper_1_1_chunk (actual rows=2505 loops=1)
               ->  Index Scan using compress_hyper_2_5_chunk__compressed_hypertable_2_dev__ts_meta_ on compress_hyper_2_5_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx1 on _hyper_1_2_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx1 on _hyper_1_3_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx1 on _hyper_1_4_chunk (actual rows=11 loops=1)
(11 rows)

SELECT decompress_chunk('_timescaledb_internal._hyper_1_1_chunk');
            decompress_chunk            
----------------------------------------
 _timescaledb_internal._hyper_1_1_chunk
(1 row)

--baseline query with skipscan
:PREFIX SELECT DISTINCT ON (dev) dev, dev_name FROM :TABLE;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx1 on _hyper_1_1_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx1 on _hyper_1_2_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx1 on _hyper_1_3_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx1 on _hyper_1_4_chunk (actual rows=11 loops=1)
(11 rows)

-- partial indexes don't prevent skipscan
DROP INDEX _timescaledb_internal._hyper_1_1_chunk_skip_scan_ht_dev_idx;
:PREFIX SELECT DISTINCT ON (dev) dev, dev_name FROM :TABLE;
                                                       QUERY PLAN                                                       
------------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=11 loops=1)
   ->  Merge Append (actual rows=44 loops=1)
         Sort Key: _hyper_1_1_chunk.dev
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_1_chunk_skip_scan_ht_dev_idx1 on _hyper_1_1_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_2_chunk_skip_scan_ht_dev_idx1 on _hyper_1_2_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_3_chunk_skip_scan_ht_dev_idx1 on _hyper_1_3_chunk (actual rows=11 loops=1)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk (actual rows=11 loops=1)
               ->  Index Scan using _hyper_1_4_chunk_skip_scan_ht_dev_idx1 on _hyper_1_4_chunk (actual rows=11 loops=1)
(11 rows)

-- IndexPath without pathkeys doesnt use SkipScan
EXPLAIN (costs off, timing off, summary off) SELECT DISTINCT 1 FROM pg_rewrite;
                               QUERY PLAN                                
-------------------------------------------------------------------------
 Unique
   ->  Index Only Scan using pg_rewrite_rel_rulename_index on pg_rewrite
(2 rows)

-- try one query with EXPLAIN only for coverage
EXPLAIN (costs off, timing off, summary off) SELECT DISTINCT ON (dev_name) dev_name FROM skip_scan;
                              QUERY PLAN                               
-----------------------------------------------------------------------
 Unique
   ->  Custom Scan (SkipScan) on skip_scan
         ->  Index Only Scan using skip_scan_dev_name_idx on skip_scan
               Index Cond: (dev_name > NULL::text)
(4 rows)

EXPLAIN (costs off, timing off, summary off) SELECT DISTINCT ON (dev_name) dev_name FROM skip_scan_ht;
                                               QUERY PLAN                                               
--------------------------------------------------------------------------------------------------------
 Unique
   ->  Merge Append
         Sort Key: _hyper_1_1_chunk.dev_name
         ->  Custom Scan (SkipScan) on _hyper_1_1_chunk
               ->  Index Only Scan using _hyper_1_1_chunk_skip_scan_ht_dev_name_idx on _hyper_1_1_chunk
                     Index Cond: (dev_name > NULL::text)
         ->  Custom Scan (SkipScan) on _hyper_1_2_chunk
               ->  Index Only Scan using _hyper_1_2_chunk_skip_scan_ht_dev_name_idx on _hyper_1_2_chunk
                     Index Cond: (dev_name > NULL::text)
         ->  Custom Scan (SkipScan) on _hyper_1_3_chunk
               ->  Index Only Scan using _hyper_1_3_chunk_skip_scan_ht_dev_name_idx on _hyper_1_3_chunk
                     Index Cond: (dev_name > NULL::text)
         ->  Custom Scan (SkipScan) on _hyper_1_4_chunk
               ->  Index Only Scan using _hyper_1_4_chunk_skip_scan_ht_dev_name_idx on _hyper_1_4_chunk
                     Index Cond: (dev_name > NULL::text)
(15 rows)

-- #3629 skipscan with constant skipscan column in where clause
CREATE TABLE i3629(a int, time timestamptz NOT NULL);
SELECT table_name FROM create_hypertable('i3629', 'time');
 table_name 
------------
 i3629
(1 row)

INSERT INTO i3629 SELECT i, '2020-04-01'::date-10-i from generate_series(1,20) i;
EXPLAIN (SUMMARY OFF, COSTS OFF) SELECT DISTINCT ON (a) * FROM i3629 WHERE a in (2) ORDER BY a ASC, time DESC;
                   QUERY PLAN                   
------------------------------------------------
 Unique
   ->  Sort
         Sort Key: _hyper_3_6_chunk."time" DESC
         ->  Append
               ->  Seq Scan on _hyper_3_6_chunk
                     Filter: (a = 2)
               ->  Seq Scan on _hyper_3_7_chunk
                     Filter: (a = 2)
               ->  Seq Scan on _hyper_3_8_chunk
                     Filter: (a = 2)
               ->  Seq Scan on _hyper_3_9_chunk
                     Filter: (a = 2)
(12 rows)

SELECT DISTINCT ON (a) * FROM i3629 WHERE a in (2) ORDER BY a ASC, time DESC;
 a |             time             
---+------------------------------
 2 | Fri Mar 20 00:00:00 2020 PDT
(1 row)

-- #3720 skipscan not being used on varchar column
CREATE TABLE i3720(time timestamptz not null,data varchar);
SELECT table_name FROM create_hypertable('i3720','time');
WARNING:  column type "character varying" used for "data" does not follow best practices
 table_name 
------------
 i3720
(1 row)

INSERT INTO i3720
SELECT time, (array['Yes', 'No', 'Maybe'])[floor(random() * 3 + 1)]
FROM generate_series('2000-01-01'::timestamptz,'2000-01-03'::timestamptz, '10 minute'::interval) AS g1(time);
CREATE INDEX ON i3720(data, time);
ANALYZE i3720;
:PREFIX SELECT DISTINCT ON(data) * FROM i3720;
                                                      QUERY PLAN                                                      
----------------------------------------------------------------------------------------------------------------------
 Unique (actual rows=3 loops=1)
   ->  Custom Scan (SkipScan) on _hyper_4_10_chunk (actual rows=3 loops=1)
         ->  Index Only Scan using _hyper_4_10_chunk_i3720_data_time_idx on _hyper_4_10_chunk (actual rows=3 loops=1)
               Index Cond: (data > NULL::text)
               Heap Fetches: 3
(5 rows)

